/*! SearchResults - 19-01-2015 09:01:16 */function makeMapSticky(a,b){$("#map-inner").unstick();var c=OT.Common.Viewport.isIpadVerticalOrSmaller()?360:$(window).height()-a;$("#map").height(c),$("#map-inner").height(c),$("#map-inner").width($("#map-inner").width()),OT.Common.Viewport.isIpadVerticalOrBigger&&$("#map-inner").sticky(b)}function getMapTopOffset(){var a=-130,b=$(".search-image").height();return $("#filters-bar").height()+b+a}function updatetravelTimeStickiness(){$("#filters-bar").unstick(),$(".search-image").unstick();var a=$(".search-image").height(),b=-130,c=a+b;$("#filters-bar").sticky({topSpacing:c}),$(".search-image").sticky({topSpacing:b})}function getFilterBarHeight(){return $("#filters-bar").height()}function updateMapStickyness(){var a=11!==OT.Search.Data.get().Request.PageType?getFilterBarHeight():getMapTopOffset();makeMapSticky(a,{topSpacing:a})}(function(){{var a,b=this,c=b.Backbone,d=[],e=(d.push,d.slice);d.splice}a="undefined"!=typeof exports?exports:b.Backbone={},a.VERSION="1.0.0";var f=b._;f||"undefined"==typeof require||(f=require("underscore")),a.$=b.jQuery||b.Zepto||b.ender||b.$,a.noConflict=function(){return b.Backbone=c,this},a.emulateHTTP=!1,a.emulateJSON=!1;var g=a.Events={on:function(a,b,c){if(!i(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!i(this,"once",a,[b,c])||!b)return this;var d=this,e=f.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,g,h,j,k,l,m;if(!this._events||!i(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(h=a?[a]:f.keys(this._events),j=0,k=h.length;k>j;j++)if(a=h[j],g=this._events[a]){if(this._events[a]=d=[],b||c)for(l=0,m=g.length;m>l;l++)e=g[l],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=e.call(arguments,1);if(!i(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&j(c,b),d&&j(d,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;"object"==typeof b&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}},h=/\s+/,i=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(h.test(c)){for(var f=c.split(h),g=0,i=f.length;i>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},j=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},k={listenTo:"on",listenToOnce:"once"};f.each(k,function(a,b){g[b]=function(b,c,d){var e=this._listeners||(this._listeners={}),g=b._listenerId||(b._listenerId=f.uniqueId("l"));return e[g]=b,"object"==typeof c&&(d=this),b[a](c,d,this),this}}),g.bind=g.on,g.unbind=g.off,f.extend(a,g);var l=a.View=function(a){this.cid=f.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},m=/^(\S+)\s*(.*)$/,n=["model","collection","el","id","attributes","className","tagName","events"];f.extend(l.prototype,g,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(b,c){return this.$el&&this.undelegateEvents(),this.$el=b instanceof a.$?b:a.$(b),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=f.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];if(f.isFunction(c)||(c=this[a[b]]),c){var d=b.match(m),e=d[1],g=d[2];c=f.bind(c,this),e+=".delegateEvents"+this.cid,""===g?this.$el.on(e,c):this.$el.on(e,g,c)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(a){this.options&&(a=f.extend({},f.result(this,"options"),a)),f.extend(this,f.pick(a,n)),this.options=a},_ensureElement:function(){if(this.el)this.setElement(f.result(this,"el"),!1);else{var b=f.extend({},f.result(this,"attributes"));this.id&&(b.id=f.result(this,"id")),this.className&&(b["class"]=f.result(this,"className"));var c=a.$("<"+f.result(this,"tagName")+">").attr(b);this.setElement(c,!1)}}});var o=function(a,b){var c,d=this;c=a&&f.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},f.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&f.extend(c.prototype,a),c.__super__=d.prototype,c};l.extend=o}).call(this);var Timer=function(a){a=a||{};var b,c=this,d=0,e=a.duration,f=0,g=0;"number"==typeof a&&(e=a),this.onEnd=a.onEnd,this.onStop=a.onStop;var h=function(){d++,a[d]&&a[d](),d>=e&&(c.reset(),c.onEnd&&c.onEnd())};this.reset=function(){d=0,clearInterval(b)},this.start=function(){this.reset(),b=setInterval(h,1e3),f=(new Date).getTime()},this.stop=function(){this.reset(),g=(new Date).getTime(),this.onStop&&this.onStop(g-f)},this.getTime=function(){return d},a.start&&this.start()};!function(a){var b={topSpacing:0,bottomSpacing:0,className:"is-sticky",wrapperClassName:"sticky-wrapper",center:!1,getWidthFrom:""},c=a(window),d=a(document),e=[],f=c.height(),g=function(){for(var b=c.scrollTop(),g=d.height(),h=g-f,i=b>h?h-b:0,j=0;j<e.length;j++){var k=e[j],l=k.stickyWrapper.offset().top,m=l-k.topSpacing-i;if(m>=b)null!==k.currentTop&&(k.stickyElement.css("position","").css("top",""),k.stickyElement.parent().removeClass(k.className),k.currentTop=null);else{var n=g-k.stickyElement.outerHeight()-k.topSpacing-k.bottomSpacing-b-i;0>n?n+=k.topSpacing:n=k.topSpacing,k.currentTop!=n&&(k.stickyElement.css("position","fixed").css("top",n),"undefined"!=typeof k.getWidthFrom&&k.stickyElement.css("width",a(k.getWidthFrom).width()),k.stickyElement.parent().addClass(k.className),k.currentTop=n)}}},h=function(){f=c.height();for(var a=0;a<e.length;a++){var b=e[a];b.stickyElement.parent().css("height",b.stickyElement.outerHeight())}},i={init:function(c){var d=a.extend(b,c);return this.each(function(){var b=a(this),c=b.attr("id"),f=a("<div></div>").attr("id",c+"-sticky-wrapper").addClass(d.wrapperClassName);b.wrapAll(f),d.center&&b.parent().css({width:b.outerWidth(),marginLeft:"auto",marginRight:"auto"}),"right"==b.css("float")&&b.css({"float":"none"}).parent().css({"float":"right"});var g=b.parent();g.css("height",b.outerHeight()),e.push({topSpacing:d.topSpacing,bottomSpacing:d.bottomSpacing,stickyElement:b,currentTop:null,stickyWrapper:g,className:d.className,getWidthFrom:d.getWidthFrom})})},update:g,unstick:function(){return this.each(function(){var b=a(this);removeIdx=-1;for(var c=0;c<e.length;c++)e[c].stickyElement.get(0)==b.get(0)&&(removeIdx=c);-1!=removeIdx&&(e.splice(removeIdx,1),b.unwrap(),b.removeAttr("style"))})}};window.addEventListener?(window.addEventListener("scroll",g,!1),window.addEventListener("resize",h,!1)):window.attachEvent&&(window.attachEvent("onscroll",g),window.attachEvent("onresize",h)),a.fn.sticky=function(b){return i[b]?i[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.sticky"):i.init.apply(this,arguments)},a.fn.unstick=function(b){return i[b]?i[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.sticky"):i.unstick.apply(this,arguments)},a(function(){setTimeout(g,0)})}(jQuery),function(a){a.fn.hasScrollBar=function(){return this.get(0).scrollHeight>this.height()},a.fn.lionbars=function(b){function c(c){var h,i=a(c);(J||I)&&i.find(".lb-wrap").on("scroll",function(){i.find(".lb-v-scrollbar-slider").css({top:-a(this).scrollTop()/i.attr("vratio")}),i.find(".lb-h-scrollbar-slider").css({left:-a(this).scrollLeft()/i.attr("hratio")}),i.find(".lb-v-scrollbar").height()!==parseInt(i.find(".lb-v-scrollbar-slider").css("top"),10)+i.find(".lb-v-scrollbar-slider").height()||"function"!=typeof b.reachedBottom||C||(C=!0,h=a(this),b.reachedBottom.apply(a(this).children(".lb-content"),[function(){r(a(h).parent(),{height:a(h).children(".lb-content").get(0).scrollHeight,width:a(h).children(".lb-content").get(0).scrollWidth}),g(a(h).parent()),e(a(h).parent()),d(a(h).parent()),f(),C=!1}])),i.find(".lb-h-scrollbar").width()!==parseInt(i.find(".lb-h-scrollbar-slider").css("left"),10)+i.find(".lb-h-scrollbar-slider").width()||"function"!=typeof b.reachedRight||D||(D=!0,h=a(this),b.reachedRight.apply(a(this).children(".lb-content"),[function(){r(a(h).parent(),{height:a(h).children(".lb-content").get(0).scrollHeight,width:a(h).children(".lb-content").get(0).scrollWidth}),g(a(h).parent()),e(a(h).parent()),d(a(h).parent()),f(),D=!1}]))}),J&&(i.find(".lb-v-scrollbar-slider").mousedown(function(b){return t=b.pageY,z=!0,A=a(this),B=i.find(".lb-wrap"),w=B.parent().attr("vratio"),x=A.position().top,!1}),i.find(".lb-v-scrollbar").mousedown(function(b){return a(b.target).hasClass("lb-v-scrollbar-slider")||i.find(".lb-wrap").scrollTop((b.pageY-a(this).offset().top)*Math.abs(i.attr("vratio"))-a(this).find(".lb-v-scrollbar-slider").height()/2),!1})),I&&(i.find(".lb-h-scrollbar-slider").mousedown(function(b){return s=b.pageX,y=!0,A=a(this),B=i.find(".lb-wrap"),w=B.parent().attr("hratio"),x=A.position().left,!1}),i.find(".lb-h-scrollbar").mousedown(function(b){return a(b.target).hasClass("lb-h-scrollbar-slider")||i.find(".lb-wrap").scrollLeft((b.pageX-a(this).offset().left)*Math.abs(i.attr("hratio"))-a(this).find(".lb-h-scrollbar-slider").width()/2),!1})),(J||I)&&autohide&&(i.find(".lb-v-scrollbar, .lb-h-scrollbar").hide(),i.hover(function(){a(this).data("hover",!0),i.find(".lb-v-scrollbar, .lb-h-scrollbar").fadeIn(150)},function(){a(this).data("hover",!1),i.find(".lb-v-scrollbar, .lb-h-scrollbar").fadeOut(150)}))}function d(b){Y=(V-a(b).find(".lb-wrap").get(0).scrollHeight-O-Q)/(ab-$),Z=(U-a(b).find(".lb-wrap").get(0).scrollWidth-R-P)/(bb-_);var c=a(b);c.attr("vratio",Y),c.attr("hratio",Z)}function e(b){var c,d,e,f=a(b);0!==f.find(".lb-v-scrollbar").length&&(c=20,e=V-f.find(".lb-v-scrollbar").height(),d=V-e-c,$=Math.round(V*d/S),$=c>$?c:$),0!==f.find(".lb-h-scrollbar").length&&(c=20,e=U-f.find(".lb-h-scrollbar").width(),d=U-e-c,_=Math.round(U*d/T),_=c>_?c:_),f.find(".lb-v-scrollbar-slider").css({height:$}),f.find(".lb-h-scrollbar-slider").css({width:_})}function f(){G=0,H=0,I=!1,J=!1,K=0,L=0,M=0,N=0,O=0,R=0,Q=0,P=0,S=0,T=0,U=0,V=0,W=0,X=0,$=0,_=0,ab=0,bb=0}function g(b){var c=a(b);J&&I?(ab=c.height()-12,bb=c.width()-12,c.find(".lb-v-scrollbar").css({height:ab}),c.find(".lb-h-scrollbar").css({width:bb})):(ab=c.height()-4,bb=c.width()-4,c.find(".lb-v-scrollbar").css({height:ab}),c.find(".lb-h-scrollbar").css({width:bb}))}function h(b,c,d){var e=a(b);(c||d)&&(e.css({overflow:"hidden"}),j(e,e.find(".lb-wrap")),i(e),k(e,e.find(".lb-wrap")))}function i(b){var c=a(b);c.css({width:c.width()+L+N,height:c.height()+K+M})}function j(b,c){var d=a(b),e=a(c);d.css({padding:0}),e.css({"padding-top":K+"px","padding-left":L+"px","padding-bottom":M+"px","padding-right":N+"px"})}function k(b,c){var d=a(b),e=a(c);d.css({position:"relative"}),e.css({width:d.width()+G-L-N,height:d.height()+H-K-M})}function l(b){var c=a(b);c.css({overflow:"auto"}),G=U-W-R-P,c.css({overflow:"hidden"})}function m(b){var c=a(b);c.css({overflow:"auto"}),H=V-X-O-Q,c.css({overflow:"hidden"})}function n(b,c,d){var e=a(b),f=e.attr("id"),g=0;void 0!==f?(e.wrapInner('<div class="lb-wrap" id="lb-wrap-'+F+"-"+f+'"></div>'),g=a("#lb-wrap-"+F+"-"+f)):(e.wrapInner('<div class="lb-wrap" id="lb-wrap-'+F+'"></div>'),g=a("#lb-wrap-"+F)),g.wrapInner('<div class="lb-content"></div>'),c&&(e.prepend('<div class="lb-v-scrollbar"></div>'),e.find(".lb-v-scrollbar").append('<div class="lb-v-scrollbar-slider"></div>')),d&&(e.prepend('<div class="lb-h-scrollbar"></div>'),e.find(".lb-h-scrollbar").append('<div class="lb-h-scrollbar-slider"></div>')),F+=1}function o(b){var c=a(b);if(J=!1,I=!1,c.find(".lb-v-scrollbar-slider").length)return!1;p(c),q(c);var d=c.css("overflow-y"),e=c.css("overflow-x");return c.css({overflow:"hidden"}),"hidden"!==d&&c.get(0).scrollHeight>c.get(0).clientHeight&&(J=!0),"hidden"!==e&&c.get(0).scrollWidth>c.get(0).clientWidth&&(I=!0),c.css({overflow:"auto"}),J||I?!0:void 0}function p(b){var c=a(b);K=parseInt(c.css("padding-top").replace("px",""),10),L=parseInt(c.css("padding-left").replace("px",""),10),M=parseInt(c.css("padding-bottom").replace("px",""),10),N=parseInt(c.css("padding-right").replace("px",""),10)}function q(b){var c=a(b);O=parseInt(c.css("border-top-width").replace("px",""),10),P=parseInt(c.css("border-right-width").replace("px",""),10),Q=parseInt(c.css("border-bottom-width").replace("px",""),10),R=parseInt(c.css("border-left-width").replace("px",""),10)}function r(b,c,d){var e=a(b).get(0);d&&(e=a(e).find(".lb-wrap").get(0)),S="undefined"!=typeof c&&c!==!1?c.height:e.scrollHeight,T="undefined"!=typeof c&&c!==!1?c.width:e.scrollWidth,X=e.clientHeight,W=e.clientWidth,V=e.offsetHeight,U=e.offsetWidth,l(a(b)),m(a(b))}b=b||{},autohide=b.autohide;var s,t,u,v,w,x,y=!1,z=!1,A=0,B=0,C=!1,D=!1,E=a(this),F=0,G=0,H=0,I=!1,J=!1,K=0,L=0,M=0,N=0,O=0,P=0,Q=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=0,$=0,_=0,ab=0,bb=0;return this.mainLoop=function(){for(var b=0;void 0!==E[b];b++)o(E[b])&&!a(E[b]).hasClass("nolionbars")&&(target=E[b],r(target),n(target,J,I),h(target,J,I),g(target),e(target),d(target),c(target),f())},this.mainLoop(),this.Update=function(){for(var b=0;void 0!==E[b];b++)o(E[b])&&!a(E[b]).hasClass("nolionbars")&&(target=E[b],r(target,!1,!0),h(target,J,I),g(target),e(target),d(target),c(target),f())},this.scrollToBottom=function(){for(var b=0;void 0!==E[b];b++)if(o(E[b])&&!a(E[b]).hasClass("nolionbars")){target=E[b],r(target,!1,!0);var c=a(target).find(".lb-wrap"),d=c.parent().attr("vratio"),e=(S-X)*Math.abs(d);c.scrollTop(e)}},a(document).mousemove(function(a){z&&(v=a.pageY,B.scrollTop((x+v-t)*Math.abs(w))),y&&(u=a.pageX,B.scrollLeft((x+u-s)*Math.abs(w)))}),a(document).mouseup(function(){z&&(z=!1),y&&(y=!1)}),this.each(function(){})},a(".js-lionbars").lionbars()}(jQuery),OT.createNS("OT.Search.Helpers.buildSearchParameters"),OT.Search.Helpers.buildSearchParameters=function(a,b){function c(a,b){var c={};return _.each(a,function(d,e){var f=b[e]||e;c[e.toLowerCase()]=a[f]}),c}function d(a,b,c){_.each(c,function(c){void 0!==a[c.toLowerCase()]&&null!==a[c.toLowerCase()]&&(b[c.toLowerCase()]=a[c.toLowerCase()])})}function e(){return void 0!==OT.Search.Helpers.QueryString().domain||void 0!==OT.Search.Helpers.QueryString().culture}var f={Sort:"SortString"};a=c(a,f)||{},b=c(b,f)||{};var g=["Title","DateTime","Covers","MetroId","RegionIds","NeighborhoodIds","PriceBandIds","CuisineIds","OfferTypeIds","RestaurantIds","OnlyExactDateTime","OnlyPopTimes","OnlyUnavailable","ShowMap","Latitude","Longitude","Distance","PopularityAlgorithm","Topic","Tests","Sort","Size","From","ExcludeFields","Attributes","TravelMode","TravelTime","Rd","PromoId","Ref","IsDateTimeCoverUpdated","IntersperseAvailability","AffiliateRestaurantId"],h=["Domain","Culture"],i={};return d(a,i,g),e()&&d(b,i,h),i},OT.createNS("OT.Search.Helpers.QueryString"),OT.Search.Helpers.QueryString=function(a){if(void 0===a&&(a=window.location.search),""===a)return{};a=a.substr(1).split("&");for(var b={},c=0;c<a.length;++c){var d=a[c].split("=");2===d.length&&(b[d[0].toLowerCase()]=decodeURIComponent(d[1].replace(/\+/g," ")))}return b},OT.createNS("OT.Search.Helpers.convertDateTimeToTimestamp"),OT.Search.Helpers.convertDateTimeToTimestamp=function(a,b){var c=Resources.Strings.DateFormat.toUpperCase().replace(/\//g,"-")+" HH:mm";b=OT.Search.Helpers.convertTimeTo24Hour(b);var d=a.replace(/\//g,"-")+" "+b;return moment(d,c).format("X")},OT.createNS("OT.Search.Helpers"),OT.Search.Helpers.convertIsoDateTimeToTimestamp=function(a,b){var c=OT.Search.Helpers.convertTimeTo24Hour(b),d=a+" "+c;return moment(d,"YYYY-MM-DD").format("X")},OT.createNS("OT.Search.Helpers.convertDateToSearchDate"),OT.Search.Helpers.convertDateToSearchDate=function(a,b){b=OT.Search.Helpers.convertTimeTo24Hour(b);var c=a.replace(/\//g,"-")+" "+b,d=Resources.Strings.DateFormat.toUpperCase().replace(/\//g,"-")+" HH:mm";return moment(c,d).format("YYYY-MM-DD HH:mm")},OT.createNS("OT.Search.Helpers.convertTimeTo24Hour"),OT.Search.Helpers.convertTimeTo24Hour=function(a){var b=a.match(/AM|PM|a.m.|p.m./i);return null!==b&&(b=b[0],a=a.replace(/ AM| PM| a.m.| p.m./i,"").split(":"),"AM"!==b&&"a.m."!==b||"12"!==a[0]||(a[0]="00"),("PM"===b||"p.m."===b)&&parseInt(a[0],10)<12&&(a[0]=parseInt(a[0],10)+12),a=a.join(":")),a},OT.createNS("OT.Search.Helpers.DateUtilities"),OT.Search.Helpers.DateUtilities=function(){var a=function(a,b){b=OT.Search.Helpers.convertTimeTo24Hour(b);var c=a.replace(/\//g,"-")+" "+b,d="YYYY-MM-DD HH:mm";return moment(c,d)},b=function(b,c){var d=a(b,c);return d.format("YYYY-MM-DD HH:mm")},c=function(b,c){var d=a(b,c);return d.format("x")},d=function(a){var b=a.minutes();return b>30?a.add("hours",1).minutes(0):a.minutes(30)};return{formatDateTimeStringsToIsoDateFormat:b,formatDateTimeStringsToUnixTimestamp:c,getDateTimeFromString:a,roundToNextHalfHour:d}}(),OT.createNS("OT.Search.Helpers.getFormattedDate"),OT.Search.Helpers.getFormattedDate=function(a){var b=void 0===a?moment():moment(a);return b.format(Resources.Strings.DateFormat.toUpperCase())},OT.createNS("OT.Search.Helpers.getFormattedTime"),OT.Search.Helpers.getFormattedTime=function(a){if(!a){var b=Resources.Strings.TimeFormatJS;a=OT.Search.Helpers.RoundTimeTo.halfHour(moment().format(b))}return a},OT.createNS("OT.Search.Helpers.getIdsFromCheckedItems"),OT.Search.Helpers.getIdsFromCheckedItems=function(a){var b=[];return $(a).find(".checkbox").each(function(){this.checked&&b.push(this.getAttribute("data-id"))}),b},OT.createNS("OT.Search.Helpers.isFutureDateTime"),OT.Search.Helpers.isFutureDateTime=function(a){return OT.Common.Helpers.isMobile().Windows()?!0:a>moment().format("X")},OT.createNS("OT.Search.Helpers.isMapShowing"),OT.Search.Helpers.isMapShowing=function(){return"true"===OT.Search.Params.get("ShowMap")||OT.Search.Params.get("ShowMap")===!0},OT.createNS("OT.Search.Helpers.renderTemplate"),OT.Search.Helpers.renderTemplate=function(a,b,c){var d=window.Spark.Shared,e=a.split("/"),f=a.charAt(a.indexOf("_")+1).toLowerCase(),g=e[e.length-1],h=f+g.substring(2),i={};return i[h]=b,c&&_.extend(i,c),e.pop(),_.each(e,function(a){d=d[a]}),void 0!==d&&d[g]?d[g].RenderView(i):void 0},OT.createNS("OT.Search.Helpers.RoundTimeTo"),OT.Search.Helpers.RoundTimeTo=function(){var a=function(a){a=OT.Search.Helpers.convertTimeTo24Hour(a);var b=a.split(":");return+b[1]>45?(b[0]++,b[1]="00"):b[1]=+b[1]>30?"45":+b[1]>15?"30":"15",moment(b[0]+":"+b[1],"H:mm").format(Resources.Strings.TimeFormatJS)},b=function(a){a=OT.Search.Helpers.convertTimeTo24Hour(a);var b=a.split(":");return b[1]>30?(b[0]++,b[1]="00"):b[1]="30",moment(b[0]+":"+b[1],"H:mm").format(Resources.Strings.TimeFormatJS)};return{quarterHour:a,halfHour:b}}(),OT.createNS("OT.Search.Requests.BuildUrl"),OT.Search.Requests.BuildUrl=function(){var a="/s/api",b=function(b,d){var e=c(b);a="/s"+e+d},c=function(a){var b=/\/([a-z]{2}-[a-zA-Z]{2})\/?/,c=b.exec(a);return null===c?"":void 0===c[1]?"":"/"+c[1]},d=function(a){if(a=a||OT.Search.Params.getAll(),_.isArray(a))throw new Error("BuildUrl: incompatible parameters format");if(_.isEmpty(a))throw new Error("BuildUrl: parameters not provided");var b=[];return _.each(a,function(a,c){b.push(c+"="+a)}),b.join("&")},e=function(a,b){var c=d(a);return b+"?"+c},f=function(){var a=_.clone(OT.Search.Params.getAll());return void 0===a.PageType&&(a.PageType=OT.Search.Data.get().Request.PageType),a};return{setApiRoute:b,api:function(b,c){var d=b||f();return e(d,c||a)},dinerschoice:function(a,b){return e(a,b||"/s/dinerschoice")},interim:function(a,b){return e(a,b||"/s/interim")},queryString:function(a){return e(a,"")},searchresults:function(a,b){return e(a,b||"/s/api")}}}(),OT.createNS("OT.Search.Requests.Results"),OT.Search.Requests.Results=function(){var a=new Timer({duration:30,10:function(){OT.Events.fire("results:slow")},onStop:function(a){OT.Search.sendLogRequest("_ResponseTime","interaction",{responseTime:a})},onEnd:function(){OT.Events.fire("results:cancel")}}),b=0,c={onSuccess:function(){},onFailure:function(){},always:function(){},additionalData:{},supressEvents:!1,retry:!0},d=function(d){if(!OT.Search.Config.get("enableJSRendering"))return OT.Common.Helpers.redirectWindow(OT.Search.Requests.BuildUrl[OT.Search.Config.get("logEventPrefix").toLowerCase()]()),!1;var h=_.defaults(d||{},_.clone(c));h.supressEvents||OT.Events.fire("results:get",[h.additionalData]),h.url=h.url||OT.Search.Requests.BuildUrl.api(),h.additionalData=h.additionalData||{},0===b&&a.start();var i=function(b){f(h,b,a),e()},j=function(a,b,c){OT.Events.fire("results:failed"),OT.Events.fire("results:error",[c]),h.retry&&g(h,c)},k=new OT.Search.Scroll;k.scrollToTop(),$.ajax({url:h.url,type:"GET",dataType:"json"}).done(i).done(h.onSuccess).fail(j).fail(h.onFailure).always(h.always)},e=function(){opts=null,b=0},f=function(a,b,c){OT.Search.Data.set(b),c.stop(),a.additionalData.supressHistory||11!==OT.Search.Data.get().Request.PageType&&OT.Search.History.update(),a.supressEvents||(OT.Events.fire("results:updated",[a.additionalData]),OT.Events.fire("results:done",[a.additionalData])),OT.Search.Data.get().Display&&OT.Search.Data.get().Display.IsInitialLoad?$("body").addClass("initial-load"):$("body").removeClass("initial-load")},g=function(a,c){OT.Events.fire("results:retry",[c,a.additionalData]),b>OT.Search.Config.get("resultRetriesMax")&&OT.Events.fire("results:cancel",[c,a.additionalData]),setTimeout(function(){d(a)},2e3*b),b++};return{get:d,cancel:e}}(),OT.createNS("OT.Search.BaseView"),OT.Search.BaseView=function(){"use strict";var a=Backbone.ViewManager=Backbone.ViewManager||{};a.BaseView=Backbone.View.extend({templateData:{},additionalData:{},onInitialize:function(){},setAttributes:function(a){var b=this;return _.each(a,function(a,c){b[c]=a}),this.onSetAttributes(),this},onSetAttributes:function(){},beforeRender:function(){return this.templateData=OT.Search.Data.get(),this},render:function(a){return this.beforeRender()?(this.templateData=a||this.templateData,this.template&&this.$el.html(OT.Search.Helpers.renderTemplate(this.template,this.templateData,this.additionalData)),this.templateData=null,this.onRender(),this):!1},onRender:function(){},unset:function(){this.stopListening(),this.onUnset()},onUnset:function(){},unsetView:function(){this.unset(),this.$el.hide(),this.$el.empty()},destroy:function(){this.unset(),this.unsetView(),this.undelegateEvents(),this.remove()},getResources:function(){return window.Resources}})}(),OT.createNS("OT.Search.BaseView"),OT.Search.BaseView=function(){"use strict";var a=Backbone.ViewManager=Backbone.ViewManager||{};a.BaseView.FilterGroup=a.BaseView.extend({template:"Common/Filters/_FilterGroup",initialize:function(){this.beforeInitialize(),OT.Events.on("results:updated",$.proxy(this,"checkIfRenderNeeded"))},beforeRender:function(){return this.templateData=OT.Search.Data.get().Filters[this.filterName],this.additionalData={title:this.title,name:this.name,param:this.paramName},this},checkIfRenderNeeded:function(a,b){b=b||{},(b.historyBack||b.modal===this.name||this.paramNotSearchedFor())&&this.render(),this.state&&this.updateStates()},paramNotSearchedFor:function(){return null===OT.Search.Data.get().Request[this.paramName]},updateStates:function(){if(!(this.paramName instanceof Array))return!1;var a=this;_.each(a.paramName,function(b){a.state[b]=null===OT.Search.Data.get().Request[b]?[]:OT.Search.Data.get().Request[b].split(",")})},beforeInitialize:function(){}})}(),OT.createNS("OT.Common.Views.Results.ResultsContainer"),OT.Common.Views.Results.ResultsContainer=Backbone.ViewManager.BaseView.extend({el:"#search_results_container",events:{"click .applied-filter .close":"removeSearchFilter","click .rest-name":"restaurantClicked","click .rest-image":"restaurantImageClicked","click .first-cell .offer":"offerClicked","click .timeslot":"timeslotClicked","mouseover .rest-name":"createRestaurantModal","mouseover .price-col .price":"createPriceModal","mouseover .first-cell .offer":"createRestaurantModal","mouseover .timeslot":"createOfferTooltip","mouseout .rest-name":"removeRestaurantModal","mouseout .first-cell .offer":"removeRestaurantModal","mouseout .price-col .price":"removePriceModal","mouseout .timeslot":"removeOfferTooltip","click #availability_link":"toggleAvailability","click #clear_last_filter":"undoLastFilter","click #start_over":"clearAllFilters"},initialize:function(){var a=this;OT.Events.on("results:get",function(){a.clearModals()}),OT.Events.on("scroll",function(){a.clearModals()}),this.tooltipDelay=100,this.priceModalDelay=50,this.restaurantModalDelay=150,this.removeModalDelayTime=100,this.filterLinks=this.$el.find(".header-cell-link"),this.currentSort=OT.Search.Data.get().Request.SortString,this.isFilterModalShowing=!1,OT.Events.on("modal:show",function(){a.isFilterModalShowing=!0}),OT.Events.on("modal:hide",function(){a.isFilterModalShowing=!1})},toggleAvailability:function(a){a.preventDefault();var b=$(a.currentTarget).hasClass("with-availability");OT.Search.Params.set({OnlyUnavailable:b}),OT.Search.Requests.Results.get()},createModalDelay:function(a,b,c){return OT.Common.Helpers.isUserScrolling()?!1:(void 0===this.modalName&&(this.modalName=b),this.modalName===b?clearTimeout(this[b+"Timeout"]):this.clearModals(),this.modalTimeout=setTimeout(c,a||0),void(this.modalName=b))},removeModalDelay:function(a,b){var c=this;clearTimeout(this.modalTimeout),c[b+"Timeout"]=setTimeout(function(){c.clearModals()},a||0)},createRestaurantModal:function(a){var b=this;if(this.filterModalIsShowing()||OT.Search.Helpers.isMapShowing())return!1;var c=$(a.currentTarget),d=c.parents(".result"),e=d.parents(".results-set"),f=c.hasClass("offer")?"offer-name":"restaurant-name",g=e.hasClass("pop-table")?"FeaturedPopRestaurants":"Restaurants",h=OT.Search.Data.get().Results[g][d.data("id")];this.createModalDelay(this.restaurantModalDelay,"restaurantModal",function(){OT.Search.views.restaurantModal.setAttributes({$target:d,templateData:h}).render();var c={position:d.data("id")+1};"offer-name"===f&&_.extend(c,{offerId:a.currentTarget.getAttribute("data-id")}),b.logEvent(a,f+"-hover",c)})},removeRestaurantModal:function(){this.removeModalDelay(this.removeModalDelayTime,"restaurantModal")},createPriceModal:function(a){var b=this;b.createModalDelay(b.priceModalDelay,"priceModal",function(){OT.Search.views.priceModal.setAttributes({$target:$(a.currentTarget)}).render()})},removePriceModal:function(){this.removeModalDelay(this.removeModalDelayTime,"priceModal")},createOfferTooltip:function(a){var b=this,c=$(a.currentTarget),d=c.parents(".result"),e=c.data("offers"),f="number"==typeof e?[e+""]:e.split(","),g=c.parents(".results-set").hasClass("pop-table")?"FeaturedPopRestaurants":"Restaurants",h={Offers:[]};""!==f[0]&&($.each(OT.Search.Data.get().Results[g][d.data("id")].Offers,function(a,b){-1!==$.inArray(b.Id+"",f)&&h.Offers.push(b.Name)}),b.isToolTip=!0,b.createModalDelay(b.tooltipDelay,"offerTooltip",function(){OT.Search.views.tooltipModal.setAttributes({$target:c,templateData:h}),OT.Search.views.tooltipModal.$el.is("visible")||OT.Search.views.tooltipModal.render(),b.logEvent(a,"timeslot-hover",{offerIds:(""+c.data("offers")).split(","),time:OT.Search.Helpers.convertTimeTo24Hour(c.find(".time").text().trim()),isExact:c.find(".time").hasClass("exact"),isPop:!!c.find(".pts").length})}))},removeOfferTooltip:function(){this.isToolTip&&this.removeModalDelay(this.removeModalDelayTime,"offerTooltip"),this.isToolTip=!1},filterModalIsShowing:function(){return!!this.isFilterModalShowing},undoLastFilter:function(){OT.Search.sendLogRequest("_clear-last-filter","interaction",{}),OT.Search.History.back(),OT.Search.Requests.Results.get(),OT.Search.Filters.render()},clearAllFilters:function(){var a=OT.Search.Helpers.isMapShowing(),b=OT.Search.Params.get("MetroId"),c=OT.Search.Params.get("Latitude"),d=OT.Search.Params.get("Longitude"),e=OT.Search.Params.get("Distance"),f=OT.Search.Params.get("Rd"),g=OT.Search.Params.get("Domain"),h=OT.Search.Params.get("Culture"),i=OT.Search.Params.get("DateTime"),j=OT.Search.Params.get("Covers");OT.Search.Params.clear(),OT.Search.sendLogRequest("_clear-all-filters","interaction",{}),OT.Search.Params.set("ShowMap",a),b&&OT.Search.Params.set("MetroId",b),c&&OT.Search.Params.set("Latitude",c),d&&OT.Search.Params.set("Longitude",d),e&&OT.Search.Params.set("Distance",e),f&&OT.Search.Params.set("Rd",f),g&&OT.Search.Params.set("Domain",g),h&&OT.Search.Params.set("Culture",h),i&&OT.Search.Params.set("DateTime",i),j&&OT.Search.Params.set("Covers",j),OT.Search.Requests.Results.get()},clearModals:function(){var a=["tooltipModal","priceModal","restaurantModal"];_.each(a,function(a){OT.Search.views[a]&&OT.Search.views[a].el&&OT.Search.views[a].el.style&&"none"!==OT.Search.views[a].el.style.display&&OT.Search.views[a].unsetView()})},removeSearchFilter:function(a){var b=$(a.currentTarget),c=b.data("filter");b.parent().remove(),OT.Events.fire("filters:remove",c)},restaurantClicked:function(a){this.logEvent(a,"restaurant-name")},restaurantImageClicked:function(a){a.preventDefault(),this.logEvent(a,"restaurant-image");var b=$(a.currentTarget).closest(".result").find("a.rest-name").attr("href");OT.Common.Helpers.redirectWindow(b)},offerClicked:function(a){this.logEvent(a,"offer-name",{offerId:a.currentTarget.getAttribute("data-id")})},timeslotClicked:function(a){var b=$(a.currentTarget);this.logEvent(a,"timeslot",{offerIds:(""+b.data("offers")).split(","),time:OT.Search.Helpers.convertTimeTo24Hour(b.find(".time").text().trim()),isExact:b.find(".time").hasClass("exact"),isPop:!!b.find(".pts").length})},logEvent:function(a,b,c){var d=$(a.currentTarget).parents(".results-set"),e="_"+d.data("name"),f=OT.Search.Data.get().Results.Restaurants[$(a.currentTarget).parents(".result").data("id")];OT.Search.sendLogRequest(e,"interaction",_.extend({rid:f.Id,type:b,hasOffers:!!f.Offers.length,position:$(a.currentTarget).parents(".result").data("id")+1},c||{}))}}),OT.createNS("OT.Search.Scroll"),OT.Search.Scroll=function(){"use strict";var a=function(){return $("#filters-bar").height()},b=function(){return $("#search_results_container").offset().top},c=function(){var c=$(document).scrollTop(),d=b()-a();d>=c||$("body,html").animate({scrollTop:d},500)};return{scrollToTop:c}},OT.createNS("OT.Redesign.BaseView"),OT.Redesign.BaseView=function(){"use strict";var a=Backbone.ViewManager=Backbone.ViewManager||{};a.BaseView.Modal=a.BaseView.extend({events:{"click .page-wrapper":"close"},onSetAttributes:function(){this.unset(),this.$searchFilters=$("#search_filters"),this.templateData={Filter:this.filterType,FilterName:this.filterName,IsChangeLocationModal:this.IsChangeLocationModal,Labels:OT.Search.Data.get().Filters[this.filterName],DistanceOptions:OT.Search.Data.get().Display.DistanceOptions||[],MetroName:OT.Search.Data.get().Display.Metro.Name,Metro:OT.Search.Data.get().Display.Metro},this.$el.data("filter-name",this.filterName),this.$el.data("filter-type",this.filterType),this.onInitialize&&this.onInitialize()},beforeRender:function(){return!0},onRender:function(){return this.$el.show(),this.position(),OT.Events.fire("modal:show"),this.$checkboxes=this.$el.find(".checkbox:not(.select-all)"),this.$selectAllLink=this.$el.find(".select-all"),this.checkSearchedFilters(),this.modalLaunchedTime=moment().format("X"),this.modalLaunchedCount=this.$el.find(".checkbox:checked").length,this.afterRender(),this
},checkSearchedFilters:function(){var a=this.$checkboxes,b=OT.Search.Params.get(this.filterType.toLowerCase());_.each(b,function(b){a.filter('.checkbox[data-id="'+b+'"]').prop("checked",!0)})},position:function(){if(!this.$searchFilters)return!1;var a=OT.Common.EnvInfo(),b=this.$target,c="fixed"===this.$searchFilters.css("position"),d=b.offset().top-a.Window.scrollTop,e=d,f="fixed",g=b.offset().left+b.outerWidth()+5-a.Window.scrollLeft;c&&(f="fixed",e=b.position().top,g=b.offset().left+b.outerWidth()+5-a.Window.scrollLeft),this.setPosition(f,e,g);var h=a.Window.height,i=this.$el.outerHeight(),j=this.$el.position().top;i+j>h&&(e+=h-(i+j+10)),this.setPosition(f,e,g)},setPosition:function(a,b,c){this.$el.css({position:a,top:b,left:c})},cancel:function(){this.close(),this.onClose&&this.onClose()},close:function(a){if(a||this.$el.is(":visible")){var b=OT.Search.Helpers.getIdsFromCheckedItems(this.$el);OT.Search.sendLogRequest("_ModalClosed","interaction",{ids:b,type:this.$el.data("filter-name"),delta:b.length-this.modalLaunchedCount,timeFromModalLaunch:moment().format("X")-this.modalLaunchedTime}),this.unsetView(),this.filterType=null,OT.Events.fire("modal:hide"),this.onClose&&this.onClose()}},afterRender:function(){}})}(),OT.createNS("OT.Redesign.Views.Modals.Restaurant"),OT.Redesign.Views.Modals.Restaurant=Backbone.ViewManager.BaseView.extend({el:"#results_modal",template:"Redesign/Modals/_RestaurantModal",beforeRender:function(){return this.additionalData={request:OT.Search.Data.get().Request,showTimeSlots:!1},!0},onRender:function(){return this.$el.show(),this.position(),this},position:function(){var a=this.$target.find(".rest-row-offer-link"),b=a.offset().top+a.height()+8,c=this.$target.find(".rest-row-name").offset().left;this.$el.css({"margin-top":b,"margin-left":c})}}),OT.createNS("OT.Redesign.Views.Modals.Tooltip"),OT.Redesign.Views.Modals.Tooltip=Backbone.ViewManager.BaseView.extend({el:"#tooltip",template:"Redesign/Modals/_OffersTooltip",beforeRender:function(){return!0},onRender:function(){return this.$el.show(),this.position(),this},position:function(){var a=this.$el.find(".menu-container"),b=this.$target.offset().top-a.height()-8,c=this.$target.offset().left;this.$el.css({"margin-top":b,"margin-left":c})}}),OT.createNS("OT.Common.Helpers.GetDeviceInfo"),OT.Common.Helpers.getDeviceInfo=function(a){"use strict";var b=OT.Common.getNavigator(),c=a.width<a.height,d=OT.Common.Helpers.isMobile(b.userAgent).Any(),e=d?a.screenWidth:a.width,f=d?a.screenHeight:a.height,g=function(){var a=0>=e||0>=f?0:Math.max(e,f);return a>0&&641>a?OT.Common.DeviceType.phone:a>640&&1025>a?OT.Common.DeviceType.tablet:a>1440&&1921>a?OT.Common.DeviceType.xLarge:a>1920?OT.Common.DeviceType.xXLarge:OT.Common.DeviceType.large};return{deviceType:g(),isPortrait:c,isMobile:d}},OT.createNS("OT.Common.Helpers.GetPageSize"),OT.Common.Helpers.getPageSize=function(){var a=$(OT.Common.getWindow());return{width:a.width(),height:a.height(),screenWidth:window.screen.width,screenHeight:window.screen.height}},OT.createNS("OT.Common.downloadGoogleMaps"),OT.Common.downloadGoogleMaps=function(a){"use strict";var b=function(){window.Geocoder||(window.Geocoder=new google.maps.Geocoder),a&&a()};window.downloadInfoBoxLibrary=function(){$.getScript("/s/Scripts/lib/_infobox.js",b)},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];return a.getElementById(c)?!1:(d=a.createElement(b),d.id=c,d.src="https://maps.googleapis.com/maps/api/js?client=gme-opentableinc&sensor=false&callback=downloadInfoBoxLibrary&libraries=places",void e.parentNode.insertBefore(d,e))}(document,"script","gmaps_api")},OT.createNS("OT.Common.Viewport"),OT.Common.Viewport=function(){"use strict";var a=768,b=function(){return d().width<=a?!0:!1},c=function(){return d().width>=a?!0:!1},d=function(){var a=window,b="inner";return"innerWidth"in window||(b="client",a=document.documentElement||document.body),{width:a[b+"Width"],height:a[b+"Height"]}};return{isIpadVerticalOrSmaller:b,isIpadVerticalOrBigger:c,getViewport:d}}(),OT.createNS("OT.Common"),OT.Common.getWindow=function(){return window},OT.Common.getNavigator=function(){return navigator},OT.Common.DeviceType={phone:"phone",tablet:"tablet",large:"large",xLarge:"xLarge",xXLarge:"xXLarge"},function(a){a("#filters-bar").unstick(),a("#filters-bar").sticky({topSpacing:0}),a(window).resize(function(){11!==OT.Search.Data.get().Request.PageType&&(a("#filters-bar").unstick(),a("#filters-bar").sticky({topSpacing:0}))})}(jQuery),OT.createNS("OT.Common.LazyLoadImages"),OT.Common.LazyLoadImages=function(){"use strict";var a,b=function(){a=[]},c=function(a,b){var c=new Image,d=a.getAttribute("data-src"),e=a.getAttribute("data-src-mobile");e&&window.innerWidth<a.getAttribute("data-mobile-size")&&(d=a.getAttribute("data-src-mobile")),c.onload=function(){a.parent?a.parent.replaceChild(c,a):a.src=d,-1===a.className.indexOf("loaded")&&(a.className+=" loaded"),b&&b()},c.src=d},d=function(a,b){b=b||0;var c=a.getBoundingClientRect();return c.top>=0&&c.left>=0&&c.top<=b+(window.innerHeight||document.documentElement.clientHeight)},e=function(){for(var b=0;b<a.length;b++)if(!a[b].processed){var e=a[b].elem;d(e,200)&&(a[b].processed=!0,c(a[b].elem))}},f=function(){var b=0,c=$("img.lazy"),d=c.length;for(b;d>b;b++)a.push({elem:c[b],processed:!1})},g=function(){b(),f(),e(),OT.Events.on("scroll:stop",e),OT.Events.on("scroll:throttled",e)},h=function(){b();var a=0,d=$("img.lazy"),e=d.length;for(a;e>a;a++)c(d[a])};return{init:g,loadAll:h}}(),OT.createNS("OT.Common.LazyLoadTopReviews"),OT.Common.LazyLoadTopReviews=function(){"use strict";function a(a){return a.offsetHeight<a.scrollHeight}var b=function(b){var c=f(b),d=e(b);$.trim(c.html())||d.data("sent")||(d.data("sent",!0),$.ajax({type:"GET",url:"/s/reviews/top/"+b}).always(function(e){if(c[0]||(d.append(Spark.Shared.Redesign.Results._TopReview.RenderView({showMap:OT.Search.Data.get().Request.ShowMap,showReview:OT.Search.Data.get().Display.ShowTopReviewsInResults,showReviewsCommingSoon:void 0===e.ReviewText})),c=f(b)),c.html(e.ReviewText),a(c[0])){var i=d.find(".rest-row-topreview").find(".topreview-show-more");i.show()}g(b).html(e.CustomerNickname),e.DinedDateTime&&h(b).html(OT.Search.Helpers.getFormattedDate(e.DinedDateTime))}))},c=function(a,b){b=b||0;var c=e(a),d=c[0],f=d.getBoundingClientRect();return f.top>=0&&f.left>=0&&f.top<=b+(window.innerHeight||document.documentElement.clientHeight)},d=function(){if(j()){var a=i(),d=0,e=a.length;for(d;e>d;d++){var f=a[d];c(f,200)&&b(f)}}},e=function(a){return $('#search_results .result[data-rid="'+a+'"]')},f=function(a){return $('#search_results .result[data-rid="'+a+'"] .topreview-text')},g=function(a){return $('#search_results .result[data-rid="'+a+'"] .topreviewer-name')},h=function(a){return $('#search_results .result[data-rid="'+a+'"] .topreview-date')},i=function(){for(var a=$("#search_results .result[data-rid]"),b=[],c=0;c<a.length;c++)b.push($(a[c]).data("rid"));return b},j=function(){return OT.Search.Data.get().Display.ShowTopReviewsInResults&&!OT.Search.Data.get().Request.ShowMap},k=function(){d(),OT.Events.on("scroll:stop",d),OT.Events.on("results:done",d),OT.Events.on("scroll:throttled",d)};return{init:k}}(),OT.createNS("OT.Common.LazyLoadBlockDayMessages"),OT.Common.LazyLoadBlockDayMessages=function(){"use strict";var a=function(){b(),OT.Events.on("scroll:stop",b),OT.Events.on("scroll:throttled",b),OT.Events.on("results:done",b)},b=function(){if(f()){var a=d(),b=c();_.each(a,function(a){var c=$(a),d=c.find(".not-available-message").first();if(d){var f=c.data("rid");e(d,f,b)}})}},c=function(){var a=OT.Search.Data.get().Display.SelectedIsoDateTime;return a.slice(0,a.indexOf("T"))},d=function(){var a=$(".result");return _.filter(a,function(a){var b=a.getBoundingClientRect();return b.top>=0&&b.left>=0&&b.top<=(window.innerHeight||document.documentElement.clientHeight)})},e=function(a,b,c){var d="/s/blockdays?id="+b+"&date="+c+"&domain="+OT.Search.Data.get().DomainCulture.Domain+"&culture="+OT.Search.Data.get().DomainCulture.Culture;$.get(d).done(function(b){if(b){var c=b.Message;0!==c.length&&a.html(b.Message)}})},f=function(){return g()&&h()},g=function(){return OT.Search.Data.get().Request.IsAvailabilityRequest},h=function(){return OT.Search.Data.get().Request.IntersperseAvailability};return{init:a}}(),OT.createNS("OT.Common.TopReviewMore"),OT.Common.TopReviewMore=function(){"use strict";var a=function(){$(document).on("click",".topreview-show-more",b),$(document).on("click",".topreview-show-less",c)},b=function(){var a=$(this),b=a.closest(".rest-row-topreview").find(".topreview-text.topreview-truncated");b.removeClass("topreview-truncated");var c=a.closest(".rest-row-topreview").find(".topreview-show-less");a.hide(),c.show()},c=function(){var a=$(this),b=a.closest(".rest-row-topreview").find(".topreview-text");b.addClass("topreview-truncated");var c=a.closest(".rest-row-topreview").find(".topreview-show-more");a.hide(),c.show()};return{init:a}}(),OT.createNS("OT.Common.init"),OT.Common.init=function(){"use strict";OT.Common.LazyLoadImages.init();var a,b=!1,c=OT.Common.EnvInfo().Window.scrollTop;$(window).on("scroll",function(){OT.Events.fire("scroll"),b||(b=!0,a=setInterval(function(){c===OT.Common.EnvInfo().Window.scrollTop&&(OT.Events.fire("scroll:stop"),b=!1,clearInterval(a)),c=OT.Common.EnvInfo().Window.scrollTop},100))}),_&&$(window).on("scroll",_.throttle(function(){OT.Events.fire("scroll:throttled")},250)),OT.Common.Config.get("EnablePageLoadLogging")&&$(window).load(function(){setTimeout(function(){OT.Common.sendLogRequest("SearchResults_PageLoad",{BrowserInfo:OT.Common.Helpers.buildBrowserProfile(),PerfInfo:OT.Common.Helpers.buildPerformanceProfile(),searchParams:OT.Search.Params.getAll()})},2e3)})},OT.createNS("OT.Common.LoadBannerEmblem"),OT.Common.LoadBannerEmblem=function(){"use strict";var a=function(){$("#emblem").one("load",function(){$(this).removeClass("hide"),$(".needs-emblem-offset").addClass("emblem-offset")}),$("#emblem").attr("src",$("#emblem").attr("data-src"))};return{init:a}}(),OT.createNS("OT.Common.sendLogRequest"),OT.Common.sendLogRequest=function(a,b,c){"use strict";if(c=c||function(){},!OT.Common.Config.get("EnableAllLogging"))return!1;if(!a)throw new Error("OTLogEvent: No log name passed");var d={commonConfig:OT.Common.Config.getAll(),sessionKey:OT.Common.Helpers.getSessionKey(),pageId:OT.Common.Helpers.getPageId(),requestId:OT.Common.Helpers.getRequestId()||OT.Common.Helpers.generateGUID(),timeFromPageLoad:OT.Common.Helpers.getTimeFromPageLoad()},e=_.extend(d,b||{});$.ajax({type:"POST",contentType:"application/json",url:"/s/api/log",data:JSON.stringify({logName:a,Data:e})}).always(function(){c(e)})},OT.createNS("OT.Common.Helpers.getRequestId"),OT.Common.Helpers.getRequestId=function(){"use strict";return function(){try{return OT.Search.Data.get().Headers.RequestId}catch(a){return OT.Common.Helpers.generateGUID()}}}(),OT.createNS("OT.Search.Views.SearchControl"),OT.Search.Views.SearchControl=Backbone.ViewManager.BaseView.extend({el:"#search_control",events:{"keup #calendar":"preventKeyPress","keydown #calendar":"preventKeyPress","change #calendar":"validateDateTime","change #time":"validateDateTime","click #find_a_table":"newSearch"},initialize:function(){this.$timeField=this.$el.find("#time"),this.$coversField=this.$el.find("#covers"),this.$calendarField=this.$el.find("#calendar"),this.setDateAndTime(),this.defaultPosition={offset:this.$el.offset().top,position:this.$el.position().top},this.$el.parent().hasClass("sticky")&&OT.Events.on("scroll",$.proxy(this,"toggleSticky"))},getSelectedDate:function(){return this.$calendarField.val()},getSelectedTime:function(){return this.$timeField.val()},newSearch:function(){OT.Search.Params.set({DateTime:OT.Search.Helpers.convertDateToSearchDate(this.getSelectedDate(),this.getSelectedTime()),Covers:this.$coversField.val(),OnlyUnavailable:null,From:0}),"21"===this.$coversField.val()?this.redirectToPrivateDining():this.submitNewSearch()},setDateAndTime:function(){var a=this.getSelectedTime(),b=this.getSelectedDate(),c=OT.Search.Helpers.isFutureDateTime(OT.Search.Helpers.convertDateTimeToTimestamp(b,a));this.currentTimeValue=c?a:OT.Search.Helpers.getFormattedTime(),this.currentDateValue=c?b:OT.Search.Helpers.getFormattedDate(),this.$timeField.val(this.currentTimeValue),this.$calendarField.val(this.currentDateValue)},validateDateTime:function(){var a=OT.Search.Helpers.convertDateTimeToTimestamp(this.$calendarField.val(),this.$timeField.val()),b=$(".search-control-container-validation");OT.Search.Helpers.isFutureDateTime(a)?(this.currentTimeValue=this.getSelectedTime(),this.currentDateValue=this.getSelectedDate(),b.hide()):(this.setDateAndTime(),b.hide().fadeIn(300))},redirectToPrivateDining:function(){var a=OT.Search.Data.get().Display.LargePartySearchUrl+OT.Search.Helpers.convertDateToSearchDate(this.getSelectedDate(),this.getSelectedTime());OT.Search.sendLogRequest("_PrivateDining","interaction",{}),OT.Common.Helpers.redirectWindow(a)},submitNewSearch:function(){var a=OT.Search.views.filters?OT.Search.views.filters.$el:$();OT.Search.Params.set(OT.Common.Helpers.buildObjectFromCheckedkItems(a)),OT.Search.History.isSupported?this.fireNewSearch():this.redirectToInterim(),OT.Search.sendLogRequest("_FindATable","results",{})},fireNewSearch:function(){OT.Search.Requests.Results.get({additionalData:{isAvailabilityRequest:!0}})},redirectToInterim:function(){OT.Common.Helpers.redirectWindow(OT.Search.Requests.BuildUrl.interim())},toggleSticky:function(){var a=this.$el.parent(),b=$("#global_header"),c=OT.Search.views.resultsContainer?OT.Search.views.resultsContainer.$el:void 0,d=a.hasClass("stuck"),e="fixed"===b.css("position"),f=OT.Common.EnvInfo().Window.scrollTop+(e?b.height():0)+8,g=f>=this.defaultPosition.offset;g&&!d?(a.addClass("stuck"),c&&c.css("margin-top",a.outerHeight()+16)):!g&&d&&(a.removeClass("stuck"),c&&c.css("margin-top",0))},preventKeyPress:function(a){a.preventDefault()}}),OT.createNS("OT.Redesign.Views.SearchAnimation"),OT.Redesign.Views.SearchAnimation=Backbone.ViewManager.BaseView.extend({el:"#loading_animation",initialize:function(){OT.Events.on("results:get",$.proxy(this,"showLoader")),OT.Events.on("results:done",$.proxy(this,"hideLoader")),OT.Events.on("results:slow",$.proxy(this,"showSlowMessage")),OT.Events.on("results:error",$.proxy(this,"showConnectionErrorMessage")),OT.Events.on("results:changed-view",$.proxy(this,"showLoader")),OT.Events.on("results:view-loaded",$.proxy(this,"hideLoader")),this.$errorContainer=this.$el.find("#loading_error_container")},showLoader:function(){width=$(window).width(),this.$errorContainer.empty(),this.$el.show().width(width)},hideLoader:function(){this.$el.hide()},showSlowMessage:function(){this.$errorContainer.text("Searching...").show()},showConnectionErrorMessage:function(){}}),OT.createNS("OT.Redesign.Views"),OT.Redesign.Views.SearchControl=OT.Search.Views.SearchControl.extend({el:"#search_control",initialize:function(){var a=this;a.$dtp=a.$(".dtp-picker"),OT.Events.on("dtp:search",function(b,c){a.$dtp[0]===c.sender[0]&&(a.performSearch(c),b.preventDefault())})},performSearch:function(a){var b=a.covers,c=a.datetime;return 11===OT.Search.Data.get().Request.PageType?void this.travelTimeSearch(c,b,this):void this.invokeSearch(c,b)},invokeSearch:function(a,b){OT.Search.Params.set({DateTime:a,Covers:b,OnlyUnavailable:null,From:null,IntersperseAvailability:null}),"21"===b?this.redirectToPrivateDining(a):this.submitNewSearch()},travelTimeSearch:function(a,b,c){var d=window.autocomplete.getPlace(),e=$("[name='searchText']").val();if(""!==e)if(d&&""!==d.name&&d.geometry)OT.Search.Params.set({Latitude:d.geometry.location.lat(),Longitude:d.geometry.location.lng(),TravelMode:$(".travel-highlighted").data("mode"),Title:e}),c.invokeSearch(a,b);else{var f=new google.maps.Geocoder;f.geocode({address:e,componentRestrictions:{country:"uk"}},function(d,f){if(f===google.maps.GeocoderStatus.OK){var g=d[0].geometry.location.lat(),h=d[0].geometry.location.lng();OT.Search.Params.set({Latitude:g,Longitude:h,TravelMode:$(".travel-highlighted").data("mode"),Title:e}),c.invokeSearch(a,b)}})}},redirectToPrivateDining:function(a){var b=OT.Search.Data.get().Display.LargePartySearchUrl+a;OT.Search.sendLogRequest("_PrivateDining","interaction",{}),OT.Common.Helpers.redirectWindow(b)}}),OT.createNS("OT.Redesign.Views.Modals"),function(a){var b=function(b,d){var e=a(window),f=b.parents(".search-results-container"),i=b.find("#single-search-modal"),j=e.width()<=640,k=d.offset().left+d.width()-b.parent().offset().left,l=c(j,f.offset().top,k,e,d);g(b,i,l),h(b,k,l,j)},c=function(a,b,c,g,h){var i=d(a,g.width()),j=h.offset().top+h.height()-b+10,k=c-i+10,l=g.scrollTop()+g.height()-b-200,m=j>l;return j=m?e(j,a):j,k=f(k),{top:j,left:k,width:i,showModalAboveReserveLink:m}},d=function(a,b){return a?b-20:660},e=function(a,b){return a-(b?215:160)},f=function(a){return Math.max(-20,a)},g=function(a,b,c){a.css({top:c.top,left:c.left,width:c.width}),b.css({width:c.width})},h=function(a,b,c,d){var e=a.find(".icon-single-search-modal"),f=a.find(".icon-single-search-modal.top"),g=a.find(".icon-single-search-modal.bottom");e.css({left:b-c.left-70}),c.showModalAboveReserveLink?(f.hide(),g.css({bottom:d?-179:-131}),g.show()):(f.show(),g.hide())},i=function(b){b.click(function(a){a.stopPropagation()}),a(document).on("click",function(){b.hide()}),a(window).resize(function(){b.hide()}),OT.Events.on("singleSearchModal:cleared",function(){b.hide()})},j=function(a,b,c,d,e){var f=e.split("?")[0],g=f+"?p="+a.covers+"&d="+a.datetime;c&&(g+="&pid="+c),d&&(g+="&ref="+d),location.href=g},k=function(){OT.Events.fire("singleSearchModal:cleared")},l=function(a,b,c,d){var e,f=moment(b),g=moment();e=f>g?f.hours(g.hours()).minutes(g.minutes()).seconds(0):g,c?m(a,e):d&&n(a,e)},m=function(a,b){var c=p(b);o(a,c)},n=function(a,b){var c=q(b);o(a,c)},o=function(a,b){a.OTdtp("set",{searchBox:!1,date:b.format("YYYY-MM-DD"),time:b.format("HH:mm")})},p=function(a){var b=moment(a),c=moment(b).hours(12).minutes(0),d=c>b;if(d)return c;var e=moment(b).hours(15).minutes(0),f=b>e;if(f)return c.add("days",1);var g=OT.Search.Helpers.DateUtilities.roundToNextHalfHour(b);return g},q=function(a){var b=moment(a),c=moment(b).hours(19).minutes(0),d=c>b;if(d)return c;var e=moment(b).hours(22).minutes(30),f=b>e;if(f)return c.add("days",1);var g=OT.Search.Helpers.DateUtilities.roundToNextHalfHour(b);return g},r=function(a,b){a.find("#restaurant-name").text(b)};OT.Redesign.Views.Modals.SingleSearchModal=Backbone.ViewManager.BaseView.extend({el:"#single-search-modal-placeholder",initialize:function(){var a=this;this.$el.hide(),i(a.$el),a.$dtp=a.$(".dtp-picker"),OT.Events.on("dtp:search",function(b,c){a.$dtp[0]===c.sender[0]&&a.search(c)})},display:function(a){var c=this.$el.data("pre-selected-date");this.restaurantId=a.restaurantId,this.promoId=a.promoId,this.ref=a.ref,this.profileUrl=a.profileUrl,k(),r(this.$el,a.restaurantName),l(this.$dtp,c,a.isLunchLink,a.isDinnerLink),b(this.$el,a.$reserveLink),this.$el.show()},search:function(a){j(a,this.restaurantId,this.promoId,this.ref,this.profileUrl)}})}(jQuery),OT.createNS("OT.Redesign.Views.Results.ResultsContainer"),OT.Redesign.Views.Results.ResultsContainer=OT.Common.Views.Results.ResultsContainer.extend({events:function(){return _.extend({},OT.Common.Views.Results.ResultsContainer.prototype.events,{"mouseover .rest-name":"","mouseout .rest-name":"","mouseover .rest-row-offer-link":"createRestaurantModal","mouseout .rest-row-offer-link":"removeRestaurantModal","mouseover .timeslot":"createOfferTooltip","mouseout .timeslot":"removeOfferTooltip","click #pop_see_all_link":"firePopOnlySearch","click .reserve-link":"createSingleSearchModal","click #availability_link":"toggleAvailability"})},toggleAvailability:function(a){a.preventDefault(),OT.Search.Params.set({from:null,IntersperseAvailability:!0}),OT.Search.Requests.Results.get()},firePopOnlySearch:function(){return OT.Search.Params.set({OnlyPopTimes:!0,From:null}),OT.Search.Requests.Results.get(),OT.Search.sendLogRequest("_PopTable","interaction",_.extend({type:"see-all-pop-link"},{})),!1},createRestaurantModal:function(a){var b=this;if(this.filterModalIsShowing())return!1;var c=$(a.currentTarget),d=c.parents(".result"),e=c.hasClass("offer")?"offer-name":"restaurant-name",f=d.data("offers"),g="number"==typeof f?[f+""]:f.split(","),h=_.filter(OT.Search.Data.get().Offers,function(a){return _.contains(g,a.Id.toString())});this.createModalDelay(this.restaurantModalDelay,"restaurantModal",function(){OT.Search.views.restaurantModal.setAttributes({$target:d,templateData:h}).render();var c={position:d.data("id")+1};"offer-name"===e&&_.extend(c,{offerId:a.currentTarget.getAttribute("data-id")}),b.logEvent(a,e+"-hover",c)})},removeRestaurantModal:function(){this.removeModalDelay(this.removeModalDelayTime,"restaurantModal")},createSingleSearchModal:function(a){if(a.preventDefault(),this.filterModalIsShowing())return!1;var b=this,c=$(a.currentTarget),d=c.parents(".result"),e=d.find(".rest-name").text(),f=d.attr("data-rid"),g=c.hasClass("lunch"),h=c.hasClass("dinner"),i=OT.Search.Params.get("PromoId"),j=OT.Search.Params.get("Ref"),k=c.attr("data-profile-url");this.createModalDelay(0,"singleSearchModal",function(){OT.Search.views.singleSearchModal.display({$reserveLink:c,restaurantName:e,restaurantId:f,isLunchLink:g,isDinnerLink:h,promoId:i,ref:j,profileUrl:k}),b.logEvent(a,e+":single-search-modal",{})})},removeSingleSearchModal:function(){this.removeModalDelay(0,"singleSearchModal")},createOfferTooltip:function(a){var b=this,c=$(a.currentTarget),d="True"===c.data("has-pop")||c.data("has-pop"),e=c.data("offers"),f="number"==typeof e?[e+""]:e.split(","),g=_.filter(OT.Search.Data.get().Offers,function(a){return _.contains(f,a.Id.toString())}),h={Offers:_.map(g,function(a){return a.Name})};return OT.Search.Data.get().Display.ShowOffersTooltip?void((""!==f[0]||d===!0)&&(d===!0&&h.Offers.push(Resources.Shared.Common.Modals.Offers_PopOfferTitle),b.isToolTip=!0,b.createModalDelay(b.tooltipDelay,"offerTooltip",function(){OT.Search.views.tooltipModal.setAttributes({$target:c,templateData:h}),OT.Search.views.tooltipModal.$el.is("visible")||OT.Search.views.tooltipModal.render(),b.logEvent(a,"timeslot-hover",{offerIds:(""+c.data("offers")).split(","),time:OT.Search.Helpers.convertTimeTo24Hour(c.find(".time").text().trim()),isExact:c.find(".time").hasClass("exact"),isPop:!!c.find(".pts").length})}))):!1},removeOfferTooltip:function(){this.isToolTip&&this.removeModalDelay(this.removeModalDelayTime,"offerTooltip"),this.isToolTip=!1},logEvent:function(a,b,c){var d=$(a.currentTarget).parents(".results-set"),e=$(a.currentTarget).parents(".result"),f="_"+d.data("name");OT.Search.sendLogRequest(f,"interaction",_.extend({rid:e.data("rid"),type:b,hasOffers:!!e.data("offers").split(",").length,position:e.data("id")+1},c||{}))},createPriceModal:function(){},removePriceModal:function(){}}),OT.createNS("OT.Redesign.Views.Results.Results"),OT.Redesign.Views.Results.Results=Backbone.ViewManager.BaseView.extend({el:"#search_results",events:{},initialize:function(){var a=this;OT.Events.on("results:updated",function(){a.render()}),this.currentSort=OT.Search.Data.get().Request.SortString,setTimeout(OT.Common.LazyLoadImages.init)},beforeRender:function(){return OT.Search.Helpers.isMapShowing()?(this.unsetView(),!1):(this.template="Redesign/Results/_ResultsTable",this.templateData=OT.Search.Data.get(),this.$el.show(),OT.Search.Data.get().Request.IsAvailabilityRequest?(0===OT.Search.Data.get().Results.Total&&(this.template="Redesign/Results/_NoResults",this.additionalData={clearLastFilter:OT.Search.History.count()>1}),this):!0)},onRender:function(){setTimeout(OT.Common.LazyLoadImages.init)},sortSearchResults:function(a){a.preventDefault();var b=this,c=$(a.currentTarget),d=c.data("sort-name");return this.currentSort===d?!1:(OT.Search.sendLogRequest("_ResultsTable","interaction",{type:"sort-order",sortBy:d}),OT.Search.Params.set({Sort:d}),void OT.Search.Requests.Results.get({onSuccess:function(){b.currentSort=d}}))}}),OT.createNS("OT.Redesign.Views.Results.Pagination"),OT.Redesign.Views.Results.Pagination=Backbone.ViewManager.BaseView.extend({el:"#search_results_container",template:"Redesign/Results/_Pagination",events:{"click .pagination-prev":"loadPrevResults","click .pagination-next":"loadNextResults","click .js-pagination-page":"loadPageResults"},initialize:function(){this.pageSize=OT.Search.Data.get().Request.Size,this.currentIndex=OT.Search.Data.get().Request.From||0,this.toggleButton(),OT.Events.on("results:done",function(){OT.Search.views.pagination.toggleButton()})},toggleButton:function(){this.currentIndex=OT.Search.Data.get().Request.From||0;var a=OT.Search.Data.get().Results.TotalAvailable;return a<=this.pageSize?($(".pagination-container").hide(),!1):($(".pagination-container").show(),0===this.currentIndex?$(".pagination-prev").addClass("pagination-unavailable"):$(".pagination-prev").removeClass("pagination-unavailable"),void(this.currentIndex+this.pageSize>=a?$(".pagination-next").addClass("pagination-unavailable"):$(".pagination-next").removeClass("pagination-unavailable")))},loadPrevResults:function(a){if(a.preventDefault(),this.currentIndex=OT.Search.Data.get().Request.From||0,0!==this.currentIndex){var b=Math.max(this.currentIndex-this.pageSize,0);OT.Search.Params.set({From:b}),OT.Search.Requests.Results.get({})}},loadNextResults:function(a){a.preventDefault(),this.currentIndex=OT.Search.Data.get().Request.From||0;var b=OT.Search.Data.get().Results.TotalAvailable,c=this.currentIndex+this.pageSize;b>c&&(OT.Search.Params.set({From:c}),OT.Search.Requests.Results.get({}))},loadPageResults:function(a){a.preventDefault();var b=$(a.currentTarget),c=b.data("from");-1===c||b.hasClass("pagination-current")||(OT.Search.Params.set({From:c}),OT.Search.Requests.Results.get({}))}}),OT.createNS("OT.Redesign.Views.Filters.Filters"),OT.Redesign.Views.Filters.Filters=Backbone.ViewManager.BaseView.extend({el:"#search_filters",template:"Redesign/Filters/_Filters",events:{"change .filter":"changedFilter","change .sort-option":"sortResults","change input[name=within_radius]:checked":"changedRadius","change #exact_time":"changedExactTime","change #only_pop":"changedOnlyPop",click:"filtersClicked"},initialize:function(){var a=this;OT.Events.on("results:get",function(){a.clearModals()}),OT.Events.on("results:done",$.proxy(this,"onRender")),OT.Events.on("filters:remove",$.proxy(this,"removeSearchFilter")),OT.Events.on("search:new",$.proxy(this,"newSearchBeingFired")),OT.Events.on("fitler-modal:submitted",function(b,c){a.setNewSearchFilters(b,c.el,c.additionalData)}),this.preventFixedPosition=!1,this.filterCheckboxes=this.$el.find(".filter"),this.changedFilterTimeout=null,this.setNewSearchFiltersTimeout=750,this.currentSort=OT.Search.Data.get().Request.SortString,this.onInitialize(),this.fixIeBug()},onRender:function(){this.setFilterCheckboxes(),this.fixIeBug()},fixIeBug:function(){if($.browser.msie&&!(parseInt($.browser.version,10)>8)){var a=/^(\S+)\s*(.*)$/,b=this.events;$.isFunction(b)&&(b=b.apply(this));var c=["change"];for(var d in b){var e=b[d];if(_.isFunction(e)||(e=this[b[d]]),!e)throw new Error('Method "'+b[d]+'" does not exist');var f=d.match(a),g=f[1],h=f[2];-1!==_.indexOf(c,g)&&(e=_.bind(e,this),""===h||this.$(h).parent().on("click",e))}}},newSearchBeingFired:function(){OT.Search.Params.set(this.buildSearchFilters(this.$el))},setFilterCheckboxes:function(){this.filterCheckboxes=this.$el.find(".filter")},filtersClicked:function(){},changedFilter:function(a){clearTimeout(this.changedFilterTimeout);var b=$(a.currentTarget);$.browser.msie&&$.browser.version<=8&&(b=b.find("input"),b.is(":checked")?b.prop("checked",!1):b.prop("checked",!0));var c=b.data("id");c="boolean"==typeof c?void 0:c,this.toggleFilterHighlight(b,c),OT.Search.sendLogRequest("_FilterClick","interaction",{id:c,type:b.data("filter-name"),position:b.parent().index(),checked:b[0].checked}),this.changedFilterTimeout=setTimeout($.proxy(this,"setNewSearchFilters"),this.setNewSearchFiltersTimeout),this.fireOmnitureEvent()},toggleFilterHighlight:function(a,b){var c='label[for="'+a.attr("id")+'"]',d=a.parent(c);this.toggleHighlight(a,d),this.triggerFilterSelectionCountWithLabel(d),this.changeRangeFilterDistance(d,b)},toggleHighlight:function(a,b){a.is(":checked")?b.addClass("highlight"):b.removeClass("highlight")},triggerFilterSelectionCountWithLabel:function(a){this.updateFilterGroupSelectionCount(a.closest(".filter-option"))},changeRangeFilterDistance:function(a,b){var c=a.closest(".filter-option");c.find(".filter-distance").text(b)},updateFilterGroupSelectionCount:function(a){if(a){var b=a.find(".highlight").length,c=b>0?"("+b+")":"";a.find(".filter-count").text(c)}},removeSearchFilter:function(a,b){this.setFilterCheckboxes(),"Locations"===b?(this.clearLocationSearchParameters(),this.filterCheckboxes.filter('[name="RegionIds"]').prop("checked",!1).end().filter('[name="NeighborhoodIds"]').prop("checked",!1)):this.filterCheckboxes.filter('[data-filter-name="'+b+'"]').prop("checked",!1),this.setNewSearchFilters()},clearLocationSearchParameters:function(){OT.Search.Params.set({MetroId:OT.Search.Data.get().Display.Metro.Id,RegionIds:null,NeighborhoodIds:null,Latitude:null,Longitude:null,Distance:null,Title:null})},clearLatLngSearchParameters:function(){OT.Search.Params.set({MetroId:OT.Search.Data.get().Display.Metro.Id,Latitude:null,Longitude:null,Distance:null,Title:null})},clearSortOptionSelection:function(){$("#sort-filters > label").removeClass("highlight")},clearDistanceOptionSelection:function(){$("#distance-filters > label").removeClass("highlight")},buildSearchFilters:function(a){var b={};return a=a||this.$el,a.find(".filter").each(function(){var a=this.getAttribute("data-filter-name").replace("_modal","");if(b[a]||(b[a]=[]),a&&this.checked){var c=this.getAttribute("data-id");b[a].push(c)}}),b},setNewSearchFilters:function(a,b,c){var d=OT.Common.Helpers.buildObjectFromCheckedkItems(b||this.$el);OT.Search.Params.set(d),OT.Search.Params.set({From:null}),OT.Search.Requests.Results.get({additionalData:c})},showRadiusErrorMessage:function(){window.alert("Please select a radius to search")},launchModal:function(a){"location"===a.currentTarget.getAttribute("data-modal-type")?this.launchLocationModal(a.currentTarget,a.currentTarget.getAttribute("data-change-location")):this.launchFilterModal(a.currentTarget)},clearModals:function(){OT.Search.views.filterModal&&OT.Search.views.filterModal.close(),OT.Search.views.locationModal&&OT.Search.views.locationModal.close()},launchFilterModal:function(a){this.clearModals(),OT.Search.views.filterModal.setAttributes({$target:$(a),filterName:a.getAttribute("data-filter-name"),filterType:a.getAttribute("data-filter-type")}).render()},launchLocationModal:function(a,b){this.clearModals(),OT.Search.views.locationModal.setAttributes({$target:$(a),filterName:a.getAttribute("data-filter-name"),filterType:a.getAttribute("data-filter-type"),IsChangeLocationModal:b||!1}).render()},unsetView:function(){},fireOmnitureEvent:function(){},changedRadius:function(a){var b=OT.Search.Data.get().Request.Distance;$target=$(a.currentTarget);var c=parseFloat($target.val());return b===c?!1:(this.clearDistanceOptionSelection(),this.toggleFilterHighlight($target),void(0===c?(this.showRadiusErrorMessage(),a.currentTarget.value=OT.Search.Params.get("Distance")):(OT.Search.Params.set({Distance:c}),this.setNewSearchFilters())))},changedExactTime:function(){$("#exact_time").is(":checked")?$("#exact-time-icon").addClass("checked"):$("#exact-time-icon").removeClass("checked")},changedOnlyPop:function(){$("#only_pop").is(":checked")?$("#only_pop_icon").addClass("checked"):$("#only_pop_icon").removeClass("checked")},sortResults:function(a){a.preventDefault(),this.currentSort=OT.Search.Data.get().Request.SortString,$target=$(a.currentTarget);var b=$target.val();if(this.currentSort===b)return!1;this.clearSortOptionSelection(),this.toggleFilterHighlight($target),OT.Search.sendLogRequest("_ResultsTable","interaction",{type:"sort-order",sortBy:b}),OT.Search.Params.set({Sort:b,From:null});
var c=this;OT.Search.Requests.Results.get({onSuccess:function(){c.currentSort=b}})}}),OT.createNS("OT.Redesign.Views.Filters.Cuisines"),OT.Redesign.Views.Filters.Cuisines=Backbone.ViewManager.BaseView.FilterGroup.extend({el:"#cuisine_filters",template:"Redesign/Filters/_FilterCuisine",beforeInitialize:function(){this.filterGroupId="cuisine_filters",this.name="Cuisines",this.filterName="Cuisines",this.paramName="CuisineIds",this.title=Resources.Shared.Redesign.Filters.Title_Cuisines,this.modalTitle=Resources.Shared.Redesign.Filters.Label_FilterBy_Cuisine,this.filterGroupClass="filter-option filter-option-cuisines"},onRender:function(){this.$el.find(".js-lionbars").lionbars(),this.$el.find(".js-toggle-menu").OTmenu()},beforeRender:function(){return this.templateData=OT.Search.Data.get().Filters[this.filterName],this.additionalData={title:this.title,name:this.name,param:this.paramName,filterGroupId:this.filterGroupId,filterName:this.filterName,modalTitle:this.modalTitle,filterGroupClass:this.filterGroupClass},this}}),OT.createNS("OT.Redesign.Views.Filters.ExactTime"),OT.Redesign.Views.Filters.ExactTime=Backbone.ViewManager.BaseView.FilterGroup.extend({el:"#exact_time_filter",template:"Redesign/Filters/_FilterExactTime",beforeRender:function(){return this.templateData=OT.Search.Data.get(),this}}),OT.createNS("OT.Redesign.Views.Filters.OnlyPopStandalone"),OT.Redesign.Views.Filters.OnlyPopStandalone=Backbone.ViewManager.BaseView.FilterGroup.extend({el:"#only_pop_filter",template:"Redesign/Filters/_FilterPopOnly",beforeRender:function(){return this.templateData=OT.Search.Data.get(),this}}),OT.createNS("OT.Redesign.Views.Filters.OfferTypes"),OT.Redesign.Views.Filters.OfferTypes=Backbone.ViewManager.BaseView.FilterGroup.extend({el:"#offer_type_filters",template:"Redesign/Filters/_FilterOffers",beforeInitialize:function(){this.filterGroupId="offer_type_filters",this.name="OfferTypes",this.paramName="OfferTypeIds",this.filterName="OfferTypes",this.title=Resources.Shared.Redesign.Filters.Title_OfferTypes,this.modalTitle=Resources.Shared.Redesign.Filters.Label_FilterBy_OfferType,this.filterGroupClass="filter-option filter-option-offers"},onRender:function(){this.$el.find(".js-lionbars").lionbars(),this.$el.find(".js-toggle-menu").OTmenu()},beforeRender:function(){return this.templateData=OT.Search.Data.get(),this.additionalData={title:this.title,name:this.name,param:this.paramName,filterGroupId:this.filterGroupId,filterName:this.filterName,modalTitle:this.modalTitle,filterGroupClass:this.filterGroupClass},this}}),OT.createNS("OT.Redesign.Views.Filters.PriceBands"),OT.Redesign.Views.Filters.PriceBands=Backbone.ViewManager.BaseView.FilterGroup.extend({el:"#price_band_filters",template:"Redesign/Filters/_FilterPrice",beforeInitialize:function(){this.filterGroupId="price_band_filters",this.name="PriceBands",this.filterName="PriceBands",this.paramName="PriceBandIds",this.title=Resources.Shared.Redesign.Filters.Title_Price,this.modalTitle=Resources.Shared.Redesign.Filters.Label_FilterBy_Price,this.filterGroupClass="filter-option filter-option-prices"},beforeRender:function(){return this.templateData=OT.Search.Data.get().Filters[this.filterName],this.additionalData={title:this.title,name:this.name,param:this.paramName,filterGroupId:this.filterGroupId,filterName:this.filterName,modalTitle:this.modalTitle,filterGroupClass:this.filterGroupClass},this},onRender:function(){this.$el.find(".js-toggle-menu").OTmenu()}}),OT.createNS("OT.Redesign.Views.Filters.Cuisines"),OT.Redesign.Views.Filters.Sort=Backbone.ViewManager.BaseView.FilterGroup.extend({el:"#sort_filters",template:"Redesign/Filters/_FilterSortOrder",beforeInitialize:function(){this.filterGroupId="sort_filters",this.title=Resources.Shared.Redesign.Filters.Label_Sort,this.filterGroupClass="filter-option filter-option-sort-orders",this.request=OT.Search.Data.get().Request},beforeRender:function(){return this.templateData=OT.Search.Data.get(),this.additionalData={title:this.title,filterGroupId:this.filterGroupId,filterGroupClass:this.filterGroupClass,request:this.templateData.Request},this}}),OT.createNS("OT.Redesign.Views.Filters.TravelModes"),OT.Redesign.Views.Filters.TravelModes=Backbone.ViewManager.BaseView.FilterGroup.extend({el:"#travel_mode_filters",template:"Redesign/Filters/_FilterTravelMode",beforeInitialize:function(){},onRender:function(){this.$el.find(".js-lionbars").lionbars()},beforeRender:function(){return this.templateData=OT.Search.Data.get(),this}}),OT.createNS("OT.Redesign.Views.Filters.TravelTimes"),OT.Redesign.Views.Filters.TravelTimes=Backbone.ViewManager.BaseView.FilterGroup.extend({el:"#travel_time_filters",template:"Redesign/Filters/_FilterTravelTime",beforeInitialize:function(){},onRender:function(){this.$el.find(".js-lionbars").lionbars()},beforeRender:function(){return this.templateData=OT.Search.Data.get(),this}}),OT.createNS("OT.Redesign.Views.TravelOptions"),OT.Redesign.Views.TravelOptions=Backbone.ViewManager.BaseView.extend({el:".dtp-picker-travel-time",template:"Redesign/TravelTimeSearch/_TravelOptions",events:{"change .filter":"changedFilter","change .sort-option":"sortResults","change input[name=within_radius]:checked":"changedRadius","change #exact_time":"changedExactTime","change #only_pop":"changedOnlyPop",click:"filtersClicked"},initialize:function(){if(11===OT.Search.Data.get().Request.PageType){var a=this;OT.Events.on("results:get",function(){a.clearModals()}),OT.Events.on("results:done",$.proxy(this,"onRender")),OT.Events.on("filters:remove",$.proxy(this,"removeSearchFilter")),OT.Events.on("search:new",$.proxy(this,"newSearchBeingFired")),OT.Events.on("fitler-modal:submitted",function(b,c){a.setNewSearchFilters(b,c.el,c.additionalData)}),OT.Events.on("dtp:rendered",function(){a.init()})}},init:function(){$(".dtp-picker-travel-time").insertBefore(".party-size-picker"),$(".dtp-picker-search-container").prependTo(".dtp-picker-form"),this.preventFixedPosition=!1,this.filterCheckboxes=this.$el.find(".filter"),this.changedFilterTimeout=null,this.setNewSearchFiltersTimeout=750,this.currentSort=OT.Search.Data.get().Request.SortString,this.onInitialize(),this.render()},beforeRender:function(){return this.templateData=OT.Search.Data.get(),this},onRender:function(){this.setFilterCheckboxes()},newSearchBeingFired:function(){OT.Search.Params.set(this.buildSearchFilters(this.$el))},setFilterCheckboxes:function(){this.filterCheckboxes=this.$el.find(".filter")},filtersClicked:function(){},changedFilter:function(a){clearTimeout(this.changedFilterTimeout);var b=$(a.currentTarget),c=b.data("id");c="boolean"==typeof c?void 0:c,this.toggleFilterHighlight(b),OT.Search.sendLogRequest("_FilterClick","interaction",{id:c,type:b.data("filter-name"),position:b.parent().index(),checked:b[0].checked}),this.changedFilterTimeout=setTimeout($.proxy(this,"setNewSearchFilters"),this.setNewSearchFiltersTimeout),this.fireOmnitureEvent()},toggleFilterHighlight:function(a){var b='label[for="'+a.attr("id")+'"]',c=a.parent(b);this.clearTimeOptionSelection(),this.toggleHighlight(a,c),this.changeRangeFilterDistance(c)},toggleHighlight:function(a,b){a.is(":checked")?b.addClass("highlight"):b.removeClass("highlight")},triggerFilterSelectionCountWithLabel:function(a){this.updateFilterGroupSelectionCount(a.closest(".dtp-travel-time-filter"))},changeRangeFilterDistance:function(a){var b=a.closest(".dtp-travel-time-filter");textLabel=a.text().trim(),b.find(".filter-travel-time").text(textLabel)},updateFilterGroupSelectionCount:function(a){if(a){var b=a.find(".highlight").length,c=b>0?"("+b+")":"";a.find(".filter-count").text(c)}},removeSearchFilter:function(a,b){this.setFilterCheckboxes(),"Locations"===b?(this.clearLocationSearchParameters(),this.filterCheckboxes.filter('[name="RegionIds"]').prop("checked",!1).end().filter('[name="NeighborhoodIds"]').prop("checked",!1)):this.filterCheckboxes.filter('[data-filter-name="'+b+'"]').prop("checked",!1),this.setNewSearchFilters()},clearLocationSearchParameters:function(){OT.Search.Params.set({MetroId:OT.Search.Data.get().Display.Metro.Id,RegionIds:null,NeighborhoodIds:null,Latitude:null,Longitude:null,Distance:null,Title:null})},clearLatLngSearchParameters:function(){OT.Search.Params.set({MetroId:OT.Search.Data.get().Display.Metro.Id,Latitude:null,Longitude:null,Distance:null,Title:null})},clearSortOptionSelection:function(){$("#sort-filters > label").removeClass("highlight")},clearDistanceOptionSelection:function(){$("#distance-filters > label").removeClass("highlight")},clearTimeOptionSelection:function(){$("#travel-time-filters > label").removeClass("highlight")},buildSearchFilters:function(a){var b={};return a=a||this.$el,a.find(".filter").each(function(){var a=this.getAttribute("data-filter-name").replace("_modal","");if(b[a]||(b[a]=[]),a&&this.checked){var c=this.getAttribute("data-id");b[a].push(c)}}),b},setNewSearchFilters:function(a,b,c){var d=OT.Common.Helpers.buildObjectFromCheckedkItems(b||this.$el);OT.Search.Params.set(d),OT.Search.Params.set({From:null}),OT.Search.Params.get().latitude&&OT.Search.Params.get().datetime&&OT.Search.Requests.Results.get({additionalData:c})},showRadiusErrorMessage:function(){window.alert("Please select a radius to search")},launchModal:function(a){"location"===a.currentTarget.getAttribute("data-modal-type")?this.launchLocationModal(a.currentTarget,a.currentTarget.getAttribute("data-change-location")):this.launchFilterModal(a.currentTarget)},clearModals:function(){OT.Search.views.filterModal&&OT.Search.views.filterModal.close(),OT.Search.views.locationModal&&OT.Search.views.locationModal.close()},launchFilterModal:function(a){this.clearModals(),OT.Search.views.filterModal.setAttributes({$target:$(a),filterName:a.getAttribute("data-filter-name"),filterType:a.getAttribute("data-filter-type")}).render()},launchLocationModal:function(a,b){this.clearModals(),OT.Search.views.locationModal.setAttributes({$target:$(a),filterName:a.getAttribute("data-filter-name"),filterType:a.getAttribute("data-filter-type"),IsChangeLocationModal:b||!1}).render()},unsetView:function(){},fireOmnitureEvent:function(){},changedRadius:function(a){var b=OT.Search.Data.get().Request.Distance;$target=$(a.currentTarget);var c=parseFloat($target.val());return b===c?!1:(this.clearDistanceOptionSelection(),this.toggleFilterHighlight($target),void(0===c?(this.showRadiusErrorMessage(),a.currentTarget.value=OT.Search.Params.get("Distance")):(OT.Search.Params.set({Distance:c}),this.setNewSearchFilters())))},changedExactTime:function(){$("#exact_time").is(":checked")?$("#exact-time-icon").addClass("checked"):$("#exact-time-icon").removeClass("checked")},changedOnlyPop:function(){$("#only_pop").is(":checked")?$("#only_pop_icon").addClass("checked"):$("#only_pop_icon").removeClass("checked")},sortResults:function(a){a.preventDefault(),this.currentSort=OT.Search.Data.get().Request.SortString,$target=$(a.currentTarget);var b=$target.val();if(this.currentSort===b)return!1;this.clearSortOptionSelection(),this.toggleFilterHighlight($target),OT.Search.sendLogRequest("_ResultsTable","interaction",{type:"sort-order",sortBy:b}),OT.Search.Params.set({Sort:b,From:null});var c=this;OT.Search.Requests.Results.get({onSuccess:function(){c.currentSort=b}})}}),OT.createNS("OT.Redesign.Views.RefineFiltersLink"),OT.Redesign.Views.RefineFiltersLink=Backbone.ViewManager.BaseView.extend({el:"#header",events:{"click #refine-filters-link":"showRefineModal"},initialize:function(){},showRefineModal:function(a){a.preventDefault(),OT.Search.views.refineFiltersModal.show()}}),OT.createNS("OT.Redesign.Views.Modals"),OT.Redesign.Views.Modals.RefineFiltersModal=Backbone.ViewManager.BaseView.extend({el:"#RefineFiltersModal",settings:{open:{opacity:0,visibility:"visible",display:"block"},close:{opacity:1,visibility:"hidden",display:"none"}},events:{"click #RefineApplyLink":"onApplyChanges","click #RefineCancelLink":"onCancelChanges"},initialize:function(){},onApplyChanges:function(a){a.preventDefault(),this.close()},onCancelChanges:function(a){a.preventDefault(),this.close()},show:function(){this.$el.css(this.settings.open).show().css({opacity:1})},close:function(){this.$el.css(this.settings.close).hide().css({opacity:0})}}),OT.createNS("OT.Redesign.Views.SearchTabs"),OT.Redesign.Views.SearchTabs=Backbone.ViewManager.BaseView.extend({el:".map-list-toggle",template:"Redesign/Filters/_FilterMapList",events:{"click #map_list_button":"toggleMap"},initialize:function(){this.selectors={body:"body"},this.$body=$(this.selectors.body);var a=this;OT.Events.on("results:done",function(){a.render()}),this.previousSort="",this.setMapClassOnBody()},onRender:function(){this.setMapClassOnBody(),this.$el.find(".js-lionbars").lionbars({autohide:!0})},beforeRender:function(){return this.templateData=OT.Search.Data.get().Request,this},listClicked:function(a){if(null!=a&&a.preventDefault(),this.isCurrentViewList())return!1;var b=this.previousSort;OT.Search.Params.set({ShowMap:!1,Sort:b}),this.viewChanged(),OT.Search.sendLogRequest("_ListTabClicks","interaction",{})},mapClicked:function(a){if(null!=a&&a.preventDefault(),this.isCurrentViewMap())return!1;var b=OT.Search.Params.get("Sort");this.previousSort=b,OT.Search.Data.get().Request.IsGeoDistanceRequest&&(b="distance"),OT.Search.Params.set({ShowMap:!0,Sort:b}),this.viewChanged(),OT.Search.sendLogRequest("_MapTabClicks","interaction",{})},viewChanged:function(){OT.Search.Requests.Results.get({supressSearchHistory:!0})},getCurrentView:function(){return OT.Search.Params.get("showmap")?"map":"list"},isCurrentViewMap:function(){return"map"===this.getCurrentView()},isCurrentViewList:function(){return"list"===this.getCurrentView()},setMapClassOnBody:function(){this.isCurrentViewMap()?this.$body.addClass("map-showing"):this.$body.removeClass("map-showing")},toggleMap:function(a){this.isCurrentViewMap()?this.listClicked(a):this.mapClicked(a)}}),OT.createNS("OT.Redesign.Views.Results.PopTable"),OT.Redesign.Views.Results.PopTable=Backbone.ViewManager.BaseView.extend({el:"#search_results_pop",template:"Redesign/Results/_PopTable",events:{"click #whats_this":"firePointsPopup"},initialize:function(){var a=this;OT.Events.on("results:updated",function(){a.render()})},beforeRender:function(){return OT.Search.Helpers.isMapShowing()?(this.unsetView(),!1):(this.templateData=OT.Search.Data.get(),!0)},onRender:function(){this.$el.show()},firePointsPopup:function(a){return OT.Common.openWindow(a.currentTarget.href,480,460,"nav",0,1),!1}}),OT.createNS("OT.Redesign.Views.Results.MapResults"),OT.Redesign.Views.Results.MapResults=Backbone.ViewManager.BaseView.extend({el:"#search_results_map",template:"Redesign/Search/Map/_ResultsMap",events:{"click .header-cell-link":"sortSearchResults"},initialize:function(){var a=this;this.mapsDownloaded=!1,this.disableMapPopups=!1,this.pinIcon="/s/content/images/icons/map-pin.png",this.pinIconHover="/s/content/images/icons/map-pin-hover.png",OT.Events.on("results:updated",function(){a.updateResults()}),OT.Events.on("map:radius-changed",function(){a.mapRadiusChanged()}),OT.Events.on("map:hovered-over",function(b,c){a.hoveredOverResult(c)}),OT.Events.on("map:hovered-out",function(b,c){a.hoveredOutMarker(c)}),this.initResults(),$(window).resize(updateMapStickyness)},onInitialize:function(){this.initialized=!0,this.ResultsListView=new OT.Redesign.Views.Results.Map.ResultsList,this.ResultsTitleView=new OT.Redesign.Views.Results.Map.ResultsTitle,this.markers=[],this.resultCount=OT.Search.Data.get().Results.Total,this.$map=this.$el.find("#results_map"),updateMapStickyness(),11===OT.Search.Data.get().Request.PageType&&updatetravelTimeStickiness()},beforeRender:function(){return this.templateData=OT.Search.Data.get(),this.additionalData={clearLastFilter:!0},this},onRender:function(){this.onInitialize()},drawPolygons:function(){var a=OT.Search.Data.get().TravelTimePolygons;if(a)for(var b=[],c=[],d=0;d<a.length;d++){for(var e=[],f=0;f<a[d].length;f++){var g=a[d][f];e.push(new google.maps.LatLng(g.Lat,g.Lon)),c.push(new google.maps.LatLng(g.Lat,g.Lon))}b.push(new google.maps.Polygon({paths:e,strokeColor:"#559ebe",strokeOpacity:.8,strokeWeight:1,fillColor:"FF0000",fillOpacity:.2})),b[d].setMap(this.map)}},initResults:function(){return this.mapsDownloaded?void this.updateMap():(OT.Common.downloadGoogleMaps($.proxy(this,"updateMap")),!1)},initSearch:function(){if(11===OT.Search.Data.get().Request.PageType&&!window.autocomplete){$(".travel-mode").unbind("click"),$(".travel-mode").click(function(a){$(".travel-mode").parent().removeClass("travel-highlighted");var b=$(a.target).parent();b.addClass("travel-highlighted"),OT.Search.Params.set({TravelMode:b.data("mode")}),OT.Search.Params.get().latitude&&OT.Search.Params.get().datetime&&OT.Search.Requests.Results.get()});var a=$("[name='searchText']"),b=OT.Search.Data.get().Request.Title;b&&""!==b&&a.val(b),a.attr("placeholder","Where are you travelling from?"),a.focusout(function(){firstValue=""===$(".pac-container .pac-item:first span:eq(3)").text()?$(".pac-container .pac-item:first .pac-item-query").text():$(".pac-container .pac-item:first .pac-item-query").text()+", "+$(".pac-container .pac-item:first span:eq(3)").text(),setTimeout(function(){$(".dtp-picker").OTdtp("set",{searchText:firstValue})})}),a.keypress(function(a){return 13!==a.keyCode&&9!==a.keyCode?!0:($(a.target).blur(),firstValue=""===$(".pac-container .pac-item:first span:eq(3)").text()?$(".pac-container .pac-item:first .pac-item-query").text():$(".pac-container .pac-item:first .pac-item-query").text()+", "+$(".pac-container .pac-item:first span:eq(3)").text(),a.target.value=firstValue,void 0)}),window.autocomplete=new google.maps.places.Autocomplete(a.get(0),{types:["geocode"],componentRestrictions:{country:"uk"}}),google.maps.event.addListener(window.autocomplete,"place_changed",function(){var a=window.autocomplete.getPlace();a.geometry&&$(".dtp-picker-button").click()})}},createCenterMarker:function(){if(11===OT.Search.Data.get().Request.PageType){var a=OT.Search.Data.get().Display.GeoLocation;if(a){var b=this;this.centreMarker=new google.maps.Marker({position:new google.maps.LatLng(a.Lat,a.Lon),map:b.map}),this.markers.push(this.centreMarker)}}},updateResults:function(){return this.checkIfNeedsRendering()?(OT.Events.fire("map:update"),void this.initResults()):!1},checkIfNeedsRendering:function(){return OT.Search.Helpers.isMapShowing()?(this.MapTitleView&&this.MapTitleView.unsetView(),this.ResultsTitleView&&this.ResultsTitleView.unsetView(),this.ResultsListView&&this.ResultsListView.unsetView(),this.render(),!0):(this.unsetView(),!1)},updateMap:function(){return this.mapsDownloaded=!0,this.$el.show(),this.resultCount=OT.Search.Data.get().Results.Total,this.infoWindow||(this.infoWindow=new InfoBox(this.defaultBoxStyles)),this.initSearch(),"TravelTimeSearch"!==OT.Search.Data.get().Request.PageTypeString||OT.Search.Data.get().Request.IsTravelTimeRequest?(this.createNewMap(),this.centerMapWithEmptyResult(),this.plotPointsOnMap(),this.createCenterMarker(),this.zoomToFitAllMarkers(),this.drawPolygons(),void updateMapStickyness()):(this.onInitialize(),void this.$el.hide())},plotPointsOnMap:function(){var a=this,b=this.$el.find(".result");this.clearMarkers(),_.each(b,function(b,c){a.createMarker(c,$(b).data("lat"),$(b).data("lon"))})},createNewMap:function(){var a={zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,streetViewControl:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_TOP},panControl:!0,panControlOptions:{position:google.maps.ControlPosition.TOP_LEFT},scrollwheel:!1};this.$map||this.onInitialize(),this.map=new google.maps.Map(this.$map[0],a)},centerMapWithEmptyResult:function(){this.resultCount||(this.map.setCenter(new google.maps.LatLng(OT.Search.Data.get().Results.Lat,OT.Search.Data.get().Results.Long)),this.map.setZoom(OT.Search.Data.get().Results.Zoom))},createMarker:function(a,b,c){var d=this,e=new google.maps.Marker({position:new google.maps.LatLng(b,c),map:d.map,title:null,icon:d.pinIcon});this.markers.push(e),google.maps.event.addListener(e,"click",function(){d.showInfoWindow(a)}),google.maps.event.addListener(e,"mouseover",function(){d.hoveredOverMarker(a)}),google.maps.event.addListener(e,"mouseout",function(){d.hoveredOutMarker(a)})},hoveredOverMarker:function(a){var b=this.getHoverListItem(a);b.addClass("hover"),this.showMarker(a)},hoveredOverResult:function(a){var b=this.getHoverListItem(a);b.addClass("hover"),this.showMarker(a)},showMarker:function(a){this.markers[a]||this.markers[a].setIcon(this.pinIconHover)},showInfoWindow:function(a){if(this.disableMapPopups)return!1;var b=this.getHoverListItem(a),c=b.find(".rest-name"),d={Id:b.data("rid"),Name:c.html(),ProfileUrl:c.attr("href"),MetaDataHtml:b.find(".rest-row-meta").html()||"",ReviewHtml:b.find(".rest-row-review").html()||""};restaurantLinkHeight=c.height(),listOfRestaurantsTitleLineHeight=c.css("line-height").replace("px",""),mapPopUpTitleLineHeight=18,numberOfRows=restaurantLinkHeight/listOfRestaurantsTitleLineHeight,numberOfRowsPossible=2,additionalHeight=numberOfRows>numberOfRowsPossible?(numberOfRows-numberOfRowsPossible)*mapPopUpTitleLineHeight-6:0,defaultBoxOffsetYAxis=130+additionalHeight;var e={boxStyle:{width:"auto"},boxClass:"map-info-window",closeBoxURL:"",pixelOffset:new google.maps.Size(-160,-defaultBoxOffsetYAxis),content:this.getHoverHtml(d)};this.markers[a]&&this.markers[a].setIcon(this.pinIconHover),$.scrollTo(b,200,{offset:this.getScrollToOffset()}),this.createInfoWindow(e,this.markers[a])},getScrollToOffset:function(){return OT.Common.Viewport.isIpadVerticalOrSmaller()?-450:11!==OT.Search.Data.get().Request.PageType?-70:-180},getHoverListItem:function(a){return this.$el.find('.result[data-id="'+a+'"]')},hoveredOutMarker:function(a){if(this.markers[a]){this.markers[a].setIcon(this.pinIcon);var b=this.getHoverListItem(a);b.removeClass("hover")}},clearMarkers:function(){var a=0,b=this.markers.length,c=this;for(a;b>a;a++)c.markers[a].setMap(null);this.centreMarker&&this.centreMarker.setMap(null),this.markers=[]},createInfoWindow:function(a,b){this.infoWindow||(this.infoWindow=new google.maps.InfoWindow(a));var c=this.infoWindow;c.setOptions(a),c.open(this.map,b),google.maps.event.addListener(this.map,"click",function(){c.close()})},zoomToFitAllMarkers:function(){var a=OT.Search.Data.get().TravelTimePolygons;if(0===OT.Search.Data.get().Results.Total&&!a)return this.map.setZoom(OT.Search.Data.get().Results.Zoom),!0;var b=0,c=this.markers.length,d=new google.maps.LatLngBounds,e=this;for(b;c>b;b++)d.extend(e.markers[b].getPosition());if(a)for(var f=0;f<a.length;f++)for(b=0;b<a[f].length;b++){var g=a[f][b];d.extend(new google.maps.LatLng(g.Lat,g.Lon))}this.map.fitBounds(d),google.maps.event.addListenerOnce(this.map,"bounds_changed",function(){this.getZoom()>17&&this.setZoom(17)})},mapRadiusChanged:function(){var a=this;Geocoder.geocode({address:this.centreLatLng.lat+","+this.centreLatLng.lng},function(b){a.getNewResults({Latitude:a.centreLatLng.lat,Longitude:a.centreLatLng.lng,Distance:$("#map_within_radius")[0].value,Title:b[0].formatted_address,Sort:"distance"})})},getNewResults:function(a){OT.Search.Params.set(a),OT.Search.Requests.Results.get()},getHoverHtml:function(a){return OT.Search.Helpers.renderTemplate("Redesign/Search/Map/_PinHover",a,{})},sortSearchResults:function(a){a.preventDefault();var b=this,c=$(a.currentTarget),d=c.data("sort-name");OT.Search.sendLogRequest("_ResultsMap","interaction",{type:"sort-order",sortBy:d}),this.currentSort!==d&&(OT.Search.Params.set("Sort",d),OT.Search.Requests.Results.get({onSuccess:function(){b.currentSort=d}}))},onUnset:function(){this.map=null,this.infoWindow=null},isElementInViewport:function(a){a instanceof jQuery&&(a=a[0]);var b=a.getBoundingClientRect();return b.top>=0&&b.left>=0&&b.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&b.right<=(window.innerWidth||document.documentElement.clientWidth)}}),OT.createNS("OT.Redesign.Views.Results.Map.ResultsList"),OT.Redesign.Views.Results.Map.ResultsList=OT.Redesign.Views.Results.ResultsContainer.extend({el:"#search_results_map .results-list",template:"Redesign/Search/Map/_ResultsList",events:{"mouseover .result":"hightlightOnMap","mouseout .result":"removeMapHighlight"},initialize:function(){var a=this;OT.Events.on("map:update",function(){a.updateResultsList()})},beforeRender:function(){return this.templateData=OT.Search.Data.get(),!0},onRender:function(){setTimeout(OT.Common.LazyLoadImages.loadAll)},updateResultsList:function(){this.additionalData={clearLastFilter:!!(OT.Search.History.count()-1)},this.render()},hightlightOnMap:function(a){OT.Events.fire("map:hovered-over",[$(a.currentTarget).data("id")])},removeMapHighlight:function(a){OT.Events.fire("map:hovered-out",[$(a.currentTarget).data("id")])}}),OT.createNS("OT.Redesign.Views.Results.Map.ResultsTitle"),OT.Redesign.Views.Results.Map.ResultsTitle=Backbone.ViewManager.BaseView.extend({el:"#search_results_map .title",template:"Common/Results/_ResultsTitle",initialize:function(){var a=this;OT.Events.on("map:update",function(){a.render()})}}),OT.createNS("OT.Search.Config"),OT.Search.Config=function(){"use strict";var a={},b={enableAllLogging:!0,enableErrorLogging:!0,enableJSRendering:!0,enablePageLoadLogging:!0,enableInteractionLogging:!0,resultRetries:3};_.each(b,function(b,c){a[c.toLowerCase()]="boolean"!=typeof b&&"number"!=typeof b?b.toLowerCase():b});var c=function(){return a},d=function(b){if("string"==typeof b)return a[b.toLowerCase()];var c=!0;return b instanceof Array?_.each(b,function(a){d(a)||(c=!1)}):_.each(b,function(a,b){d(b)||(c=!1)}),c},e=function(b,c){if("object"==typeof b){var d={};_.each(b,function(a,b){d[b.toLowerCase()]=a}),_.extend(a,d)}else a[b.toLowerCase()]=c};return{get:d,getAll:c,set:e}}(),OT.createNS("OT.Search.Data"),OT.Search.Data=function(){"use strict";var a=window.OTSearchData||{};window.OTSearchData&&(window.OTSearchData=null);var b=function(){return a},c=function(b){_.extend(a,b)},d=function(){a={}};return{get:b,set:c,clear:d}}(),OT.createNS("OT.Search.Params"),OT.Search.Params=function(){var a=OT.Search.Helpers.buildSearchParameters(OT.Search.Data.get().Request,OT.Search.Data.get().DomainCulture),b=["MetroId","DateTime","Covers","Sort","Tests","PopularityAlgorithm","ExcludeFields","Domain","Culture","Rd","PromoId","Ref","From","Size","IntersperseAvailability"],c=function(b){return b?_.has(a,b.toLowerCase())?a[b.toLowerCase()]:null:a},d=function(){return a},e=function(b,c){if(void 0===b&&void 0===c)throw new Error("SearchParams: No parameters passed");return null!==c&&void 0!==c?(a[b.toLowerCase()]=c,!0):(_.each(b,function(b,c){null===b||void 0===b||0===b.length?delete a[c.toLowerCase()]:a[c.toLowerCase()]=b}),this)},f=function(b){var c=b&&b instanceof Array?b:[].slice.call(arguments);_.each(c,function(b){delete a[b.toLowerCase()]})},g=function(d){var e={};return d||_.each(b,function(b){e[b]=_.has(a,b.toLowerCase())?c(b):null}),a={},this},h=function(a){var b=OT.Search.Params.getAll(),c=[a,b];return _.each(c,function(a){_.each(a,function(b,c){b instanceof Array&&(a[c]=b.join(","))})}),_.isEqual(a,b)};return OT.Events.on("testObject:updated",function(a,b){e("tests",b)}),{get:c,getAll:d,isEqual:h,set:e,remove:f,clear:g}}(),OT.createNS("OT.Search.History"),OT.Search.History=function(){"use strict";var a=[],b=!(!window.history||!window.history.pushState),c=function(c,d){var e=OT.Search.Params.getAll();(b||d)&&void 0!==window.performance&&2!==window.performance.navigation.type&&window.history.replaceState(e,document.title,c||document.location.search),a.push(_.clone(e))},d=function(c,d){var e=OT.Search.Params.getAll();(b||d)&&window.history.pushState(e,document.title,c||OT.Search.Requests.BuildUrl.queryString(e)),a.push(_.clone(e))},e=function(){var b=a.length-1;if(b>0){var c=f(b);OT.Search.Params.clear().set(c),a=a.splice(0,b)}},f=function(b){return a[b-1]||{}},g=function(){a=[a[0]]},h=function(){return a.length};return{update:d,setInitialState:c,get:f,back:e,clear:g,count:h,isSupported:b}}(),OT.createNS("OT.Search.sendLogRequest"),OT.Search.sendLogRequest=function(a,b,c){if(a=OT.Search.Config.get("LogEventPrefix")+a,!OT.Search.Config.get("EnableAllLogging"))return!1;if(!OT.Search.Config.get("EnableInteractionLogging"))return!1;var d={source:"SearchResults",searchConfig:OT.Search.Config.getAll(),searchParams:OT.Search.Params.getAll(),resultsCount:{Total:OT.Search.Data.get().Results.Total,TotalAvailable:OT.Search.Data.get().Results.TotalAvailable,TotalUnavailable:OT.Search.Data.get().Results.TotalUnavailable}};OT.Common.sendLogRequest(a,_.extend(d,c||{}))},OT.createNS("OT.Redesign.init"),OT.Redesign.init=function(){"use strict";OT.Common.LazyLoadTopReviews.init(),OT.Common.LazyLoadBlockDayMessages.init(),OT.Common.TopReviewMore.init(),OT.Common.LoadBannerEmblem.init(),OT.Search.Config.set({showDistanceInResults:OT.Common.TestObject.isActive("ShowDistanceInResults"),resultRetriesMax:3,logEventPrefix:"Redesign"}),11!==OT.Search.Data.get().Request.PageType&&(OT.Search.History.setInitialState(),OT.Search.History.isSupported&&(window.onpopstate=function(a){return null===a.state||OT.Search.Params.isEqual(a.state)?!1:(OT.Search.Params.clear().set(a.state),void OT.Search.Requests.Results.get({additionalData:{supressHistory:!0,historyBack:!0}}))})),OT.Common.Config.get("EnablePageLoadLogging")&&$(window).load(function(){setTimeout(function(){OT.Common.sendLogRequest("PageLoad",{BrowserInfo:OT.Common.Helpers.buildBrowserProfile(),PerfInfo:OT.Common.Helpers.buildPerformanceProfile(),searchParams:OT.Search.Params.getAll()})},2e3)}),OT.Events.on("results:cancel",function(){OT.Search.sendLogRequest("_ResultsTimeout","results"),OT.Common.Helpers.redirectWindow(OT.Search.Requests.BuildUrl.queryString())}),OT.Events.on("results:error",function(a,b){OT.Search.sendLogRequest("_ResultsError","results",{errorMessage:b})}),OT.Search.Requests.BuildUrl.setApiRoute(window.location.pathname,"/api"),OT.createNS("OT.Common.views"),OT.createNS("OT.Search.helpers"),OT.createNS("OT.Search.views"),OT.createNS("OT.Redesign.views"),OT.Search.views.refineFiltersModal=new OT.Redesign.Views.Modals.RefineFiltersModal,OT.Search.views.restaurantModal=new OT.Redesign.Views.Modals.Restaurant,OT.Search.views.tooltipModal=new OT.Redesign.Views.Modals.Tooltip,OT.Search.views.singleSearchModal=new OT.Redesign.Views.Modals.SingleSearchModal,OT.Search.views.refineFiltersLink=new OT.Redesign.Views.RefineFiltersLink,OT.Search.views.resultsContainer=new OT.Redesign.Views.Results.ResultsContainer,OT.Search.views.results=new OT.Redesign.Views.Results.Results,OT.Search.views.popTable=new OT.Redesign.Views.Results.PopTable,OT.Search.views.searchAnimation=new OT.Redesign.Views.SearchAnimation,OT.Search.views.pagination=new OT.Redesign.Views.Results.Pagination,OT.Search.views.filters=new OT.Redesign.Views.Filters.Filters,OT.Search.views.cuisineFilters=new OT.Redesign.Views.Filters.Cuisines,OT.Search.views.offerTypesFilters=new OT.Redesign.Views.Filters.OfferTypes,OT.Search.views.priceBandFilters=new OT.Redesign.Views.Filters.PriceBands,OT.Search.views.sortFilters=new OT.Redesign.Views.Filters.Sort,OT.Search.views.exactTime=new OT.Redesign.Views.Filters.ExactTime,OT.Search.views.onlyPopStandalone=new OT.Redesign.Views.Filters.OnlyPopStandalone,OT.Search.views.travelModes=new OT.Redesign.Views.Filters.TravelModes,OT.Search.views.travelTimes=new OT.Redesign.Views.Filters.TravelTimes,OT.Search.views.travelOptions=new OT.Redesign.Views.TravelOptions,OT.Search.views.searchControl=new OT.Redesign.Views.SearchControl,OT.Search.helpers.isMapShowing=new OT.Search.Helpers.isMapShowing,OT.Search.views.searchTabs=new OT.Redesign.Views.SearchTabs,OT.Search.views.results.mapResults=new OT.Redesign.Views.Results.MapResults};